\documentclass[twoside,a4paper,11pt,halfparskip,DIV=11,notitlepage]{scrartcl}
\usepackage{scrpage2}
\usepackage{amsmath}
\usepackage[pdfauthor={},pdftitle={},pdfstartview=FitH,pdfborder={0 0 0}]{hyperref}
\usepackage[ngerman]{babel}
\usepackage{float}
\usepackage{tikz}
\usetikzlibrary{positioning,arrows}
\usepackage[european]{circuitikz}
\usepackage{pgfplots}
\pgfplotsset{compat=1.16}

\definecolor{HB9UFblue}{RGB}{0,61,165}
\definecolor{HB9UFred}{HTML}{ED135A}

\newcommand{\uline}[1]{%
    \tikz[baseline=(todotted.base)]{
        \node[inner sep=1pt,outer sep=0pt] (todotted) {#1};
        \draw[color=HB9UFblue,thick] (todotted.south west) -- (todotted.south east);
    }%
}%

\newcommand{\udash}[1]{%
    \tikz[baseline=(todotted.base)]{
        \node[inner sep=1pt,outer sep=0pt] (todotted) {#1};
        \draw[dashed,color=HB9UFred,thick] (todotted.south west) -- (todotted.south east);
    }%
}%


\title{NanoVNA Workshop}
\author{UHF-Gruppe der USKA, Version 0.1}
\date{Mathias Weyland, HB9FRV} % FIXME: Und andere
\pagestyle{scrheadings}
%\setkomafont{pagehead}{\sf}

% FIXME
\usepackage{tikz}
\usetikzlibrary{shadows}
\addtokomafont{descriptionlabel}{\normalfont}
\usepackage{tcolorbox}
\tcbuselibrary{skins,breakable}

\tcbset{
mybox/.style={
  breakable,
  enhanced standard,
  boxrule=0.4pt,titlerule=-0.2pt,drop fuzzy shadow,
  width=\linewidth,
  title style={top color=myblue!30,bottom color=myblue!0.5},
  overlay unbroken and first={
    \path[fill=myblue]
    ([xshift=5pt,yshift=-\pgflinewidth]frame.north west) to[out=0,in=180] ([xshift=20pt,yshift=-5pt]title.south west) -- ([xshift=-20pt,yshift=-5pt]title.south east) to[out=0,in=180] ([xshift=-5pt,yshift=-\pgflinewidth]frame.north east) -- cycle;
  },
  fonttitle=\Large\bfseries\sffamily,
  fontupper=\sffamily,
  fontlower=\sffamily,
  before=\par\medskip\noindent,
  after=\par\medskip,
  center title,
  toptitle=3pt,
  top=11pt,topsep at break=-5pt,
  colback=white
}}

\newtcolorbox{lernziele}[1][\linewidth]{mybox,width=#1,title=Lernziele}

\newcounter{uebungscounter}
\newcommand{\uebung}[1]{
    \stepcounter{uebungscounter}
    \section{Übung \arabic{uebungscounter}: #1}
    \renewcommand{\labelenumi}{\arabic{uebungscounter}.\arabic{enumi}}
}
\newcommand{\loesungen}{
    \section*{Lösungen zu Übung \arabic{uebungscounter}}
}
%\setcounter{secnumdepth}{0} % sections are level 1

\sloppy

\begin{document}
\maketitle
\thispagestyle{empty}

\tableofcontents

\vfill

%\includegraphics[width=\textwidth]{titelbild.png} % FIXME

\vfill

\newpage

%   \uebung{Erste Schritte}
%   In dieser Übung trainieren Sie den Umgang mit dem GNU Radio Companion (GRC) und lernen erste Blöcke kennen.

%   \begin{lernziele}
%   \begin{itemize}
%   \item Sie können in GNU Radio Blöcke einfügen, löschen, verbinden und trennen.
%   \item Sie können einfache Wellenformen mit \hl{Signal Source} generieren.
%   \item Sie können Signale im Zeit- und Frequenzraum visualisieren.
%   \item Sie wissen, dass das Spektrum eigentlich auch negative Frequenzen aufweist.
%   \item Sie können Flows in GRC starten und stoppen.
%   \item Sie verstehen, wann der \hl{Throttle}-Block zum Einsatz kommt.
%   \end{itemize}
%   \end{lernziele}

\section{Grundlagen}

\begin{itemize}
    \item Transmissions- vs. Reflexionsmessung
    \item SWR, RL, IL
    \item Complex Loads
    \item Smith Diagramm
    \item Calibration
\end{itemize}

\section{Experiment: Abschlüsse im Smith Diagramm}

\section{Experiment: Antenne messen}

\section{Filter}\label{sec:filter}

\subsection{Theorie}
Filter lassen einige Frequenzen des Spektrums passieren (Passband), während
sie andere Frequenzen reflektieren oder dissipieren. Die Pass- und Sperr-Charakteristika von Filtern werden üblicherweise mit einer
Transmissionsmessung bestimmt. Unter Umständen ist allerdings
auch eine Reflexionsmessung zielführend, z.B. wenn ein Duplexer abgestimmt
werden muss. Handelt es sich bei dem Filter nicht um ein 50~$\Omega$ System
(z.B. ein Keramik-Filter), muss die Fehlanpassung berücksichtigt werden.

\subsection{Messung}
Es werden eine Reihe von Filter (FIXME Bandpass-Filter für das 40~m Band,
diverse mechanische Kavitäten und Duplexer) auf ihre Eigenschaften hin
untersucht.

\begin{enumerate}
    \item Wählen Sie einen Filter für Ihre Messung aus. Falls Sie eine 70~cm
        Duplexer, Tiefpass oder Hochpass wählen, bietet es sich an, das Experiment
        mit einem Filter mit mehr bzw. weniger Kavitäten zu Wiederholen und
        allfällige Unterschiede zu begutachten.
    \item Stellen Sie die gewünschte Zielfrequenz ein und kalibrieren Sie das
        Gerät für eine Transmissionsmessung. Dabei ist darauf zu achten, dass
        bei Zuhilfenahme oder Weglassen von Adapter zwischen Kalibrierung und
        Messung, ein Fehler eingeführt wird.
    \item Schleifen Sie das Filter ein und charakterisieren Sie es.
    \item Konsultieren Sie im aktuellen Aufbau auch die Reflexionsmessung.
    \item Zusatzfrage zur Messung der Kavitäten: Ein UHF Umsetzer benötigt eine
        Iolation von ca. 80~dB. Kann dieser Umstand mit dem NanoVNA überprüft werden?


\end{enumerate}

\section{Koaxiale Stub-Filter}
\subsection{Theorie}
Eine Leitung -- z.B. ein Koaxialkabel -- der Länge $\lambda/4$ hat besondere
Eigenschaften: Ein Kurzschluss am einen Ende sieht vom anderen Ende aus wie
eine offene Verbindung; eine offene Verbindung am einen Ende sieht vom anderen
Ende aus wie ein Kurzschluss. Die Impedanz wird also transformiert, die
Struktur wird deshalb auch Viertelwellentransformator genannt. Im Smith-Diagramm
wird eine Abschlussimpedanz am Ende der Leitung in einem Halbkreis im Gegenuhrzeigersinn
rotiert. Zwei $\lambda/4$-Leitungen hintereinander entsprechen einer Leitung
der Länge $\lambda/2$, im Smith-Diagramm erfolgen zwei Rotationen um je einen
Halbkreis bzw. eine Rotation um einen Vollkreis: Die $\lambda/2$-Leitung
transformiert eine beliebige Impedanz (abgesehen von Verlusten im Kabel) auf
sich selbst.

Diese Eigenschaft kann genutzt werden, um mit Koaxialkabel einen relativ
schmalbandigen Sperr-Filter (Notch) zu implementieren. Dazu wird, wie in Abbildung
\ref{fig:quarterwavestub} gezeigt, mit einem T-Stück die $\lambda/4$-Leitung
parallel geschaltet. 

Die Viertelwellentransformation mag etwas verwirrend erscheinen, ein Zahlenbeispiel
soll deshalb an dieser Stelle für etwas Klarheit sorgen: Für eine Frequenz von
30~MHz ist die Wellenlänge ca. $\lambda$=10~m. Eine Halbwellenleitung hat deshalb
die Länge $\lambda/2$=5~m und eine Vierteilwellenleitung $\lambda/4$=2.5~m. Ein
Kurzschluss am Ende dieser $\lambda/4$ Leitung wird deshalb bei 30~MHz zu einer
offenen Verbindung transformiert, welche die beiden anderen am T-Stück
angeschlossenen Leitungen keinen Einfluss hat. Bei der doppelten Frequenz, also
60~MHz, hat diese Leitung aber nicht mehr die Länge  $\lambda/4$, sondern
$\lambda/2$! Da die Leitung am Ende nach wie vor kurzgeschlossen ist, wird dieser
Kurzschluss bei 60~MHz also unmittelbar in das T-Stück transformiert, und ein
Kurzschluss führt zu einer Totalreflexion: Die Struktur sperrt bei 60~MHz. Das
selbe Phänomen tritt auch bei 120~MHz, 180~MHz etc. auf. Die Einfügungsdämpfung
ist in Abbildung \ref{fig:quarterwaveplot} dargestellt. Die gestrichelte Linie
zeigt ein Stub mit offenem (anstelle eines kurzgeschlossenen) Ende. Die Sperrwirkung
erfolgt dort bereits bei 30~Mhz, da bei dieser Frequenz das offene Ende in einen
Kurzschluss transformiert wird.

\begin{figure}[H]
\begin{center}
\begin{tikzpicture}
\begin{axis}[
    xmin=0, xmax=300,
    ymin=-35, ymax=5,
    grid=both,
    xlabel={Frequenz / MHz},
    ylabel={Dämpfung $S_{21}$ / dB},
    xtick = {0,30,...,300},
%   ticks=none,
    height=6cm,
    width=0.9\textwidth,
    major grid style={black!10}
]
\addplot[color=HB9UFblue,thick] table[,x index = {0}, y index = {1}] {quarterwave.dat};
\addplot[color=HB9UFred,thick,dashed] table[,x index = {0}, y index = {2}] {quarterwave.dat};
\end{axis}
\end{tikzpicture}
\end{center}
\caption{Einfügungsdämpfung eines Stub-Filters der Länge 2.5~m. Die ausgezogene Linie beschreibt den Filterverlauf
eines kurzgeschlossenen Stubs, wärend die gestrichelte Linie den Filterverlauf eines Stubs mit offenem Ende beschreibt.}
\label{fig:wuarterwaveplot}
\end{figure}

Das Vorgehen für die Messung eines Stub-Filters mit dem NanoVNA unterscheidet
sich nicht von den übrigen Filtermessungen in Abschnitt \ref{sec:filter}. Weil
aber interessante leitungstheoretische Aspekte eine Rolle spielen, werden diese
Stub-Filter hier separat behandelt.

\subsection{Messung}
% Requirements:
% 2x BNC-SMA Adapter
% BNC T-Stück
% Versch. BNC Kabel
% BNC Female-Female Adapter
% Extra BNC-SMA Adapter für Abschluss

Es werden Stub-Filter verschiedenere Länge mit offenem und kurgeschlossenem Ende charakterisiert.

\begin{enumerate}
    \item Bauen Sie das Stub-Filter wie in Abbildung \ref{fig:quarterwavestub} auf und schliessen Sie ihn für eine
        Transmissionsmessung an den NanoVNA an.
    \item Kalibrieren Sie das Messgerät, während der Stub vom T-Stück getrennt ist.
    \item Schliessen Sie Leitungen verschiedener Länge an den dritten Anschluss des T-Stücks, nachdem Sie deren
        Länge gemessen haben. Sie können auch mehrere Kabel mit einem Adapter verbinden. Stimmen die Ergebnisse qualitativ?
    \item Schliessen Sie den Stub mit ihrem Kalibrierungs-Kit und einem Adapter kurz. Wie verändert sich die Filterkurve?
    \item Bestimmen Sie den Verkürzungsfaktor des verwendeten Koaxialkabels.
    \item Konsultieren Sie im aktuellen Aufbau auch die Reflexionsmessung.
\end{enumerate}


\section{Mantelwellensperren}

\subsection{Theorie}

Eine Mantelwelle ist eine Welle, die sich auf dem Aussenleiter (Mantel) eines
Koaxialkabels ausbreitet. Dies ist in aller Regel aus verschiedenen Gründen
unterwünscht; um die Mantelwelle zu unterbinden, wird eine Mantelwellensperre
eingesetzt. Diese Mantelwellensperre soll für Gegentaktsignale wie das
Empfangssignal von der Antenne zum Empfänger und das Sendesignal vom Sender
zur Antenne durchlässig sein; für Gleichtaktsignale wie die Mantelwelle soll
die Mantelwellensperre nicht durchlässig sein.

Die Messung einer Mantewellensperre hat deshalb drei Aspekte:

\begin{enumerate}
    \item Durchlässigkeit von Gegentaktsignalen.
    \item Dämpfung von Gleichtaktsignalen.
    \item Verhalten unter Last (Erwärmung etc.)
\end{enumerate}

Mit einem VNA werden typischerweise nur die ersten beiden Aspekte erfasst,
Erwärmung unter Last kann z.B. mit einem Thermomenter, einer Wärmebildkamera
etc. erfasst werden und wird an dieser Stelle nicht besprochen.

\subsubsection{Gegentaktmessung}\label{sec:gegentaktmessung}

Die Gegentaktmessung ist einfach: Der VNA wird für eine Transmissionsmessung
kalibriert, die Sperre wird eingeschleift und die Einfüngungsdämpdung wird
gemessen. Eine gute Mantelwellensperre sollte bei dieser Messung eine geringe
Einfügungsdämpfung aufweisen.

\subsubsection{Gleichtaktmessung}

Für die Gleichtaktmessung wird die Mantelwellensperre auf eine besondere
Art und Weise mit dem VNA verbunden: Der Eingang wird mit dem Stimulus,
der Ausgang mit dem detektierenden Port verbunden. Allerdings werden die
beiden beiden Leiter der Leitung jeweils kurzgeschlossen und mit dem
Innenleiter der Ports verbunden; die beiden Aussenleiter der Ports werden
kurzgeschlossen. Wenn die so präparierte Mantewellensperre als diskretes
Bauteil betrachtet wird (siehe FIXME), so entspricht diese Messung der
seriellen Transmissionsmessung dieses Bauteils. Eine gute Mantelwellensperre
sollte bei dieser Messung eine hohe Einfügungsdämpfung haben.

Für diese Messung steht eine spezielle Apparatur zu Verfügung, welche die
Aussenleiter der beiden VNA-Ports kurzschliesst. Die Mantelwellensperre
kann dann über  Klemmen mit den beiden Innenleitern verbunden werden.

\subsection{Messung}
Es werden eine Reihe von Mantelwellensperren unterschiedlicher Ausführung
(FIXME) und Qualität auf ihre Eigenschaften hin untersucht. 

\begin{enumerate}
    \item Wählen Sie eine Mantelwellensperre für Ihre Messung aus.
    \item Bereiten Sie den VNA für eine Transmissionsmessung im Kurzwellenbereich vor und kalibrieren Sie das Gerät.
    \item Prüfen Sie die Gegentakteigenschaften der Sperre wie in Abschnitt \ref{sec:gegentaktmessung} beschrieben.
    \item Entfernen Sie die Messkabel und befestigen Sie die Testapparatur für die Messung der Gleichtakteigenschaften (Siehe Abbildung \ref{fig:gleichtaktmessung}). %FIXME Bild
    \item Bewegen Sie die Klemmen und betrachten Sie die Auswirkungen auf die gemessene Dämpfung. Werden die beiden Klemmen nahe beieinander gehalten, nimmt die Dämpfung aufgrund von Kopplung ab.
    \item Verbinden Sie die beiden Klemmen und kalibrieren Sie das Gerät erneut für eine Transmissionsmessung.
    \item Schlissen Sie die Mantelwellensperre an, indem Sie an Ein- und Ausgang der Mantelwellensperre jeweils eine Klemme befestigen. Die Klemme soll jeweils beide Leitungen kurzschliessen oder mit dem Aussenleiter verbunden sein.
\end{enumerate}

\section{Schwingquarz}

\subsection{Theorie}
Ein Schwingquarz ist ein Bauteil, welches zur Erzeugung von Schwingungen oder
als Filter verwendet werden kann. Ein vereinfachtes Ersatzschaltbild ist in
Abbildung \ref{fig:quarzersatz} dargestellt. 

\begin{figure}[H]
    \begin{center}
    \begin{circuitikz} \draw
        (0,0) to[short,o-*] (1,0) to[short] 
            (1,-1) to[L=$L_1$] (3,-1) to[C=$C_1$] (5,-1) to[R=$R_1$] (7,-1) to[short] (7,0) to[short,*-o] (8,0)
        (1,0) to[short] (1,1) to[C=C$_0$] (7,1) to[short] (7,0);
    \end{circuitikz}
    \end{center}
    \caption{Vereinfachtes Ersatzschaltbild eines Schwingquarzes.}
    \label{fig:quarzersatz}
\end{figure}

Im Ersatzschaltbild ist zu erkennen, dass der Schwingquarz aus einem Serien-Schwingkreis ($L_1$, $C_1$, $R_1$)
und einer dazu parallelen Kapazität C$_0$ besteht. Der Quarz hat aufgrund dieser Schaltung zwei Resonanzstellen:
Wie in Abbildung \ref{fig:quarzidealplot} gezeigt erfolgt die erste beim
Nulldurchgang des Blindwiderstandes, bei der zweiten ist der Blindwiderstand
unendlich gross. Diese beiden Resonanzstellen werden Resonanzfrequenz $f_r$
bzw. Antiresonanzfrequenz $f_a$ genannt. $f_r$ ist stets etwas geringer als
$f_a$. Für die Frequenz des Schwingquarzes wird $f_r$ angegeben, welche
annähernd (aber nicht genau) der Resonanzfrequenz des Serienschwingkreises
aus $L_1$, $C_1$ und $R_1$ entspricht:

$$
f_r \approx \frac{1}{2\pi\sqrt{L_1\cdot C_1}}
$$



\begin{figure}
\begin{center}
\begin{tikzpicture}
\pgfplotsset{set layers}
\begin{axis}[
    xmin=15.89, xmax=15.95,
    ymin=-65, ymax=5,
    grid=both,
    ylabel={\uline{Dämpfung $S_{21}$}},
    ytick = {-60,-50,...,0},
    ticks=none,
    height=6cm,
    width=0.9\textwidth,
    major grid style={black!10}
]
\addplot[color=HB9UFblue,thick] table[,x index = {0}, y index = {1}] {quarz.dat};
\end{axis}
\begin{axis}[
    xmin=15.89, xmax=15.95,
    ymin=-10000, ymax=10000,
    grid=none,
    separate axis lines,
    ylabel style = {align=center},
    xlabel={Frequenz},
    ylabel={\udash{Blindwiderstand $X/\Omega$}},
    ticks=none,
    ymajorticks=true,
    yminorticks=true,
    scaled ticks=false,
    ytick = {0},
    axis y line*=right,
    height=6cm,
    width=0.9\textwidth,
    major grid style={black!10}
]
\addplot[color=HB9UFred,thick,dashed,restrict x to domain=15.89:15.9234] table[,x index = {0}, y index = {2}] {quarz.dat};
\addplot[color=HB9UFred,thick,dashed,restrict x to domain=15.9236:15.95] table[,x index = {0}, y index = {2}] {quarz.dat};
\end{axis}
\end{tikzpicture}
\end{center}
\caption{Einfügungsdämpfung (ausgezogen) und Blindwiderstand $X$ (gestrichelt, negativ wenn kapazitiv) der Ersatzschaltung
aus Abbildung \ref{fig:quarzersatz}. Es sind zwei Resonanzstellen sichtbar.}
\label{fig:quarzidealplot}
\end{figure}

Mit einer Transmissionsmessung lassen sich $f_r$ und $f_a$ messen, wobei besonders $f_a$ von parasitären Komponenten
stark beeinflusst werden kann. Der Quarz wird für die Messung in die Zusatzapparatur eingespannt, die auch für die
Charakterisierung der Mantelwellensperre benutzt worden ist. Dabei müssen folgende Punkte beachtet werden:

\begin{itemize}
    \item Weil Schwingquarze sehr schmalbandig sind und der NanoVNA nur 101 Punkte aufnimmt, muss zur Verhinderung grosser Messfehler ein entsprechend kleiner Frequenzbereich ausgewählt werden.
    \item Weil das Ersatzschaltbild aus Abbildung \ref{fig:quarzersatz} lediglich eine Vereinfachung darstellt, werden bei der Messung in der Praxis oberhalb von $f_r$ Nebenresonanzen auftreten.
\end{itemize}

Es gibt weitere, teilweise bessere Methoden, einen Schwingquarz zu charakterisieren (mit einem VNA und auch mit
anderen Gerätschaften.) Für eine gute Übersicht sei auf \cite{kortke2002} verwiesen.

\subsection{Messung}

Es wird ein 16~MHz Schwingquarz charakterisiert.

\begin{enumerate}
    \item Befestigen Sie die Testapparatur für das Einschleifen von Bauteilen (FIXME) an Ihren NanoVNA.
    \item Decken Sie mit dem Frequenzbereich den gesamten Kurzwellenbereich ab und kalibrieren Sie den VNA für eine
        Durchgangsmessung, nachdem Sie die beiden Klemmen kurzgeschlossen haben.
    \item Montieren Sie den Quarz und führen Sie eine Transmissionsmessung durch? Finden Sie die Resonanzfrequenz und
        mit dem Marker und notieren Sie sie.
    \item Wählen Sie eine feinere Spanne von 15.75~MHz bis 16.25~MHz,
        rekalibrieren Sie das Gerät und suchen Sie die Resonanzfrequenz erneut. Wie stark unterscheiden sich die ermittelten Werte?
    \item Stellen Sie sicher, dass Sie den Grund für die Abweichung der beiden Messungen genau verstehen. Wie genau ist die zweite Messung?
    \item Beachten Sie die Nebenresonanzen, die in Abbildung \ref{fig:quarzidealplot} nicht auftreten.
    \item Wählen Sie eine Frequenzspanne, mit der fast nur noch die beiden Resonanzstellen zu sehen sind. Erhöhen Sie $C_0$, indem Sie einen 10~pF Kondensator parallel zum Schwingquarz schalten. Wie verändern sich die Resonanzstellen, und was bedeutet dies im Zusammenhang mit der externen Beschaltung des Quarzes?
    \item Untersuchen Sie das Oberschwingungsverhalten des Bauteils.

\end{enumerate}

\section{Menü}

\newpage % FIXME

\scalebox{0.93}{\rotatebox{90}{\begin{tikzpicture}[font=\sffamily]
    \definecolor{marker}{HTML}{f9f871};
    \definecolor{stimulus}{HTML}{ffc75f};
    \definecolor{cal}{HTML}{ff9671};
    \definecolor{recall}{HTML}{ff6f91};
    \definecolor{config}{HTML}{d65db1};
    % Spare color: #845ec2
    \definecolor{trace0}{RGB}{255,200,0};
    \definecolor{trace1}{RGB}{0,155,255};
    \definecolor{trace2}{RGB}{0,220,0};
    \definecolor{trace3}{RGB}{220,0,220};
    \tikzstyle{menu}=[draw, text width=5em, text centered, minimum height=2em, node distance=2em,on grid]
    \tikzstyle{marker}=[fill=marker]
    \tikzstyle{stimulus}=[fill=stimulus]
    \tikzstyle{cal}=[fill=cal]
    \tikzstyle{recall}=[fill=recall]
    \tikzstyle{config}=[fill=config]
    % Main
    \node[menu] (display) {Display};
    \node[menu,marker,below of=display] (marker) {Marker};
    \node[menu,stimulus,below of=marker] (stimulus) {Stimulus};
    \node[menu,cal,below of=stimulus] (cal) {Cal};
    \node[menu,recall,below of=cal] (recall) {Recall};
    \node[menu,config,below of=recall] (config) {Config};

    % Display
    \node[menu,right=30em of display] (trace) {Trace};
    \node[menu,below of=trace] (format) {Format};
    \node[menu,below of=format] (scale) {Scale};
    \node[menu,below of=scale] (channel) {Channel};
    \node[menu,below of=channel] (transform) {Transform};

    \node[menu,right=30em of trace] (trace0) {\colorbox{trace0}{Trace 0}};
    \node[menu,below of=trace0] (trace1) {\colorbox{trace1}{Trace 1}};
        \node[menu,below of=trace1] (trace2) {\colorbox{trace2}{Trace 2}};
        \node[menu,below of=trace2] (trace3) {\colorbox{trace3}{Trace 3}};

    \node[menu,right=20em of format]  (logmag) {Logmag};
    \node[menu,below of=logmag]  (phase) {Phase};
    \node[menu,below of=phase]  (delay) {Delay};
    \node[menu,below of=delay]  (smith) {Smith};
    \node[menu,below of=smith]  (swr) {SWR};
    \node[menu,below of=swr]  (more) {More...};

    \node[menu,right=10em of more]  (polar) {Polar};
    \node[menu,below of=polar]  (linear) {Linear};
    \node[menu,below of=linear] (real) {Real};
    \node[menu,below of=real]  (imag) {Imag};
    \node[menu,below of=imag]  (resistance) {Resistance};
    \node[menu,below of=resistance] (reactance) {Reactance};

    \node[menu,below right=14em and 20em of scale]  (scalediv) {Scale/Div};
    \node[menu,below of=scalediv]  (referenceposition) {Ref. Pos};
    \node[menu,below of=referenceposition]  (electricaldelay) {Elec. Delay};

    \node[menu,right=10em of channel] (channel0) {CH 0};
    \node[menu,below of=channel0] (channel1) {CH 1};

    \node[menu,below right=5em and 10em of transform] (transformon) {Transf. on};
    \node[menu,below of=transformon] (lowpassimpulse) {LP impulse};
    \node[menu,below of=lowpassimpulse] (lowpassstep) {LP step};
    \node[menu,below of=lowpassstep] (bandpass) {Bandpass};
    \node[menu,below of=bandpass] (window) {Window};
    \node[menu,below of=window] (velocityfactor) {Vel. Factor};

    \node[menu,below right=7em and 10em of window] (minimum) {Minimum};
    \node[menu,below of=minimum] (normal) {Normal};
    \node[menu,below of=normal] (maximum) {Maximum};

    % Marker
    \node[menu,marker,below right=26em and 30em of marker] (selectmarker) {Select M.};
    \node[menu,marker,below of=selectmarker] (markerstart) {Start};
    \node[menu,marker,below of=markerstart] (markerstop) {Stop};
    \node[menu,marker,below of=markerstop] (markercenter) {Center};
    \node[menu,marker,below of=markercenter] (markerspan) {Span};

    \node[menu,marker,right=10em of selectmarker] (marker1) {Marker 1};
    \node[menu,marker,below of=marker1] (markeri) {...};
    \node[menu,marker,below of=markeri] (marker4) {Marker 4};
    \node[menu,marker,below of=marker4] (alloff) {All Off};

    % Stimulus
    \node[menu,stimulus,right=20em of stimulus] (start) {Start};
    \node[menu,stimulus,below of=start] (stop) {Stop};
    \node[menu,stimulus,below of=stop] (center) {Center};
    \node[menu,stimulus,below of=center] (span) {Span};
    \node[menu,stimulus,below of=span] (cwfreq) {CW Freq};
    \node[menu,stimulus,below of=cwfreq] (pausesweep) {Pause Swp.};

    % Cal
    \node[menu,cal,right=10em of cal] (calibrate) {Calibrate};
    \node[menu,cal,below of=calibrate] (calsave) {Save};
    \node[menu,cal,below of=calsave] (reset) {Reset};
    \node[menu,cal,below of=reset] (correction) {Correction};

    \node[menu,cal,below right=12em and 10em of calibrate] (open) {Open};
    \node[menu,cal,below of=open] (short) {Short};
    \node[menu,cal,below of=short] (load) {Load};
    \node[menu,cal,below of=load] (isoln) {Isoln};
    \node[menu,cal,below of=isoln] (thru) {Thru};
    \node[menu,cal,below of=thru] (done) {Done};

    \node[menu,cal,below right=24em and 10em of calsave] (save0) {Save 0};
    \node[menu,cal,below of=save0] (savei) {...};
    \node[menu,cal,below of=savei] (save4) {Save 4};

    % Recall
    \node[menu,recall,below right=10 em and 10em of recall] (recall0){Recall 0};
    \node[menu,recall,below of=recall0] (recalli){...};
    \node[menu,recall,below of=recalli] (recall4){Recall 4};

    % Config
    \node[menu,config,below right=20em and 10em of config] (touchcal) {Touch Cal};
    \node[menu,config,below of=touchcal] (touchtest) {Touch Test};
    \node[menu,config,below of=touchtest] (configsave) {Save};
    \node[menu,config,below of=configsave] (version) {DFU};

    \draw[thick,-stealth'] (display) -- (trace);
    \draw[thick,-stealth'] (marker) -- +(25em,0em) |- (selectmarker);
    \draw[thick,-stealth'] (stimulus) -- (start);
    \draw[thick,-stealth'] (cal) -- (calibrate);
    \draw[thick,-stealth'] (recall) -- +(5.5em,0em) |- (recall0);
    \draw[thick,-stealth'] (config) -- +(4.5em,0em) |- (touchcal);

    \draw[thick,-stealth'] (trace) -- (trace0);
    \draw[thick,-stealth'] (format) -- (logmag);
    \draw[thick,-stealth'] (scale) -- +(15em,0em) |- (scalediv);
    \draw[thick,-stealth'] (channel) -- (channel0);
    \draw[thick,-stealth'] (transform) -- +(5em,0em) |- (transformon);
    \draw[thick,-stealth'] (window) -- +(5em,0em) |- (minimum);

    \draw[thick,-stealth'] (more) -- (polar);

    \draw[thick,-stealth'] (selectmarker) -- (marker1);

    \draw[thick,-stealth'] (calibrate) -- +(5.5em,0em) |- (open);
    \draw[thick,-stealth'] (calsave) -- +(4.5em,0em) |-(save0);
\end{tikzpicture}}}

\bibliographystyle{unsrt} % FIXME is in TOC?
\bibliography{nanovna_workshop_skript}


\end{document}
