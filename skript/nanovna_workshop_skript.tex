% Authors:
% M. Weyland (2020, 2021, 2022, 2023)
% S. Navert (2022)
% A. Weyland (2020)
% H. Baur (2020)

\documentclass[twoside,a4paper,11pt,halfparskip,DIV=11,notitlepage]{scrartcl}
\usepackage{scrlayer-scrpage}
\usepackage{amsmath}
\usepackage[pdfauthor={},pdftitle={},pdfstartview=FitH,pdfborder={0 0 0},bookmarksdepth=3]{hyperref}
\usepackage[ngerman]{babel}
\usepackage{babelbib}
\usepackage{float}
\usepackage{tikz}
\usetikzlibrary{positioning,arrows}

\usepackage{ccicons}
\usepackage{siunitx}
\usepackage{booktabs}
\usepackage{qrcode}
\usepackage{amssymb}

\input{config.tex}

\definecolor{marker}{HTML}{f9f871}
\definecolor{stimulus}{HTML}{ffc75f}
\definecolor{cal}{HTML}{ff9671}
\definecolor{recall}{HTML}{ff6f91}
\definecolor{config}{HTML}{d65db1}
% Spare color: #845ec2
\definecolor{trace0}{RGB}{255,200,0}
\definecolor{trace1}{RGB}{0,155,255}
\definecolor{trace2}{RGB}{0,220,0}
\definecolor{trace3}{RGB}{220,0,220}

\newcommand*\cleartoleftpage{%
  \clearpage
  \ifodd\value{page}\hbox{}\newpage\fi
}

\title{NanoVNA Primer}
\author{\sf UHF-Gruppe der USKA}
\date{\sf Version 1.1, CC BY-SA 4.0 \ccbysa}
\pagestyle{scrheadings}
%\setkomafont{pagehead}{\sf}

\usepackage{tikz}

%\setcounter{secnumdepth}{0} % sections are level 1

\sloppy

\begin{document}
\begin{titlepage}
    \begin{tikzpicture}[remember picture, overlay]
        \node[anchor=north west] at (current page.north west) {\includegraphics[height=297mm]{logo.jpg}};
\end{tikzpicture}
\vfill
\vspace*{1em}{\hspace{3cm}\centering\Huge\sf\bfseries{NanoVNA Primer\par}}
\vspace{1em}{\hspace{3cm}\centering\huge\sf UHF-Gruppe der USKA\par}
\vspace{1em}{\hspace{3cm}\centering\huge\sf Version 1.1, CC BY-SA 4.0 \ccbysa\par}
\vfill
\clearpage
\vspace*{\fill}
\parbox{0.6\textwidth}{\scriptsize Webseite der UHF-Gruppe der USKA (Informationen, Relais, Projekte, Forum, Beitrittsforumlar etc.):\par
\url{https://www.hb9uf.ch}
}

\qrcode[height=3cm]{http://www.hb9uf.ch}
\vspace{1cm}

\parbox{0.6\textwidth}{\scriptsize Link zur aktuellen Version dieses Dokumentes:\par
\url{https://github.com/HB9UF/nanovna_workshop/releases}
}

\qrcode[height=3cm]{https://github.com/HB9UF/nanovna_workshop/releases}
\vspace{1cm}

\scriptsize © UHF Gruppe der USKA, 2020, 2021, 2022
\end{titlepage}

%\thispagestyle{empty}
%\areaset[0cm]{\paperwidth}{\paperheight}
%\typearea[current]{current}

%\includegraphics[height=\textheight]{logo.jpg}

%\vspace{5cm}
%foo


\cleardoublepage

\maketitle

\setcounter{tocdepth}{1}
\tableofcontents

%\vspace{2cm}

%\hfill\includegraphics[width=2cm]{figures/hb9uf_logo.pdf}

\newpage

% FIXME: Einleitung

\section{Grundlagen}

\subsection{Ports, Reflexions- und Transmissionsmessung}\label{sec:ports}
Netzwerkanalysatoren sind Geräte, mit denen Transmissions- und
Reflexionseigenschaften von Hochfrequenznetzwerken frequenzabhängig ermittelt
werden können. Sie dienen dem Ausmessen von Antennen, Filtern, Transformatoren,
Baluns, Matching-Netzwerken, Splittern, Verstärkern, Stubs und vielem mehr. Ein
vollwertiger Netzwerkanalysator hat zwei Anschlüsse (sogenannte Ports), ① und ②.
Das Gerät kann sowohl an Port ① als auch an Port ② ein Prüfsignal (einen 
Stimulus) generieren. Bei aktiviertem Stimulus wird gemessen, wie viel des
Signals reflektiert wird (also in den aussendenden Port zurück gelangt), und
wie viel davon das zu testende Netzwerk durchwandert und zum jeweils anderen
Port gelangt (Transmission).

Viele Geräte -- darunter auch der NanoVNA -- implementieren vielfach nur einen Teil
dieser Messungen. Manchmal kommt der Stimulus nur aus einem der beiden Ports
und der Prüfling muss von Hand umgedreht werden; oder es sind nur
Reflexionsmessungen möglich, letzteres z.B. bei einem Antennen-Analyzer. So
oder so wird entweder nur die Amplitude (skalar) oder die Amplitude und Phase
(Vektor) gemessen (siehe Abschnitt \ref{sec:vectors}).

Die Reflexions- und die Transmissionsmessung sind in
Abbildung \ref{fig:testset} schematisch dargestellt: Ein aus Port ① ausgehender
Stimulus trifft auf einen Prüfling (ein Filter, eine Antenne etc.). Ein Teil
der eintreffenden Energie wird zurück zu Port ① reflektiert und dort gemessen
(Reflexionsmessung, S11). Der Rest wird entweder vom Prüfling in Wärme umgewandelt,
als Radiowelle abgestrahlt oder gelangt (falls vorhanden) an den Ausgang des
Prüflings. Die Energie am Ausgang des Prüflings wird Port ② zugeführt
und dort gemessen (Transmissionsmessung, S21).

\begin{figure}[H]
    \begin{center}
        \includegraphics{figures/vna_dut_setup/vna_dut_setup.pdf}
    \end{center}
    \caption{Ein aus Port ① ausgehender Stimulus trifft auf einen Prüfling (device under test (DUT), z.B
        ein Filter, eine Antenne etc.). Ein Teil der eintreffenden Energie wird zurück zu Port ① reflektiert
        (Reflexionsmessung). Der Rest wird entweder vom Prüfling in Wärme umgewandelt, als Radiowelle
        abgestrahlt oder gelangt (falls vorhanden) an den Ausgang des Prüflings. Die Energie am Ausgang
        des Prüflings wird Port ② zugeführt und dort gemessen (Transmissionsmessung). Die Begriffe ``CH0''
        und ``CH1'' beziehen sich auf den NanoVNA und sind ansonsten unüblich.}
    \label{fig:testset}
\end{figure}

\subsection{Rückführungsdämpfung, Einfügedämpfung und Standing Wave Ratio}

Die durch Reflexion zurückgeführte Leistung wird mit der Leistung des Stimulus verglichen. Reflektiert
der Prüfling die gesamte Leistung, so erhält Port ① genausoviel Leistung zurück, wie er im Stimulus
ausgesandt hat (Kabeldämpfungen werden durch Kalibrierung korrigiert und sind deshalb hier vernachlässigt,
siehe Abschnitt \ref{sec:calibration}). Da die beiden Leistungen gleich gross sind, spricht man von
einer Rückführungsdämpfung von 0~dB. Reflektiert der Prüfling die halbe Leistung des Stimulus so spricht
man von einer Rückführungsdämpfung von 3~dB. Oft wird die Rückführungsdämpfung negativ angegeben, also
in diesem Fall -3~dB, was nicht ganz korrekt ist - es handelt sich ja schliesslich um eine Dämpfung 
und -3~dB Dämpfung wären +3~dB Verstärkung, was in dieser passiven Situation nicht eintreten kann.
Im Folgenden wird diese Konvention trotzdem verwendet, weil sie sich eingebürgert hat.

Das im Amateurfunk beliebte Stehwellenverhältnis (standing wave ratio, SWR) bezeichnet eigentlich
ein Amplitudenverhältnis von speziellen Stellen entlang einer Leitung (z.B. Koaxialkabel oder
Hühnerleiter). Bei der Bestimmung des SWR wird aber in den seltensten Fällen die Leitung an sich
untersucht. Oft ist die Leitung auch derart kurz, dass diese speziellen Stellen gar nicht auftreten.
Der Begriff ist deshalb leider etwas fehlgeleitet. Tatsächlich wird in aller Regel die Rückführungsdämpfung
gemessen und mit den entsprechenden Formeln in ein Stehwellenverhältnis umgesetzt. Tabelle \ref{tab:rlswr}
gibt den Zusammenhang zwischen Rückführungsdämpfung und SWR für ausgewählte Grössen an.

\begin{table}[H]
    \caption{Gegenüberstellung von SWR, Rückführungsdämpfung und dem prozentualen Anteil reflektierter Leistung.}
    \label{tab:rlswr}
\begin{center}\begin{tabular}{SSS}\toprule
{\textbf{SWR}} & {\textbf{Rückführung}} & {\textbf{\% Reflkt.}}\\\midrule
1.0 & {-$\infty$} & 0.0\\
1.1 & -26.44 & 0.2\\
1.2 & -20.83 & 0.8\\
1.3 & -17.69 & 1.7\\
1.4 & -15.56 & 2.8\\
1.5 & -13.98 & 4.0\\
1.6 & -12.74 & 5.3\\
1.7 & -11.73 & 6.7\\
1.8 & -10.88 & 8.2\\
1.9 & -10.16 & 9.6\\
2.0 & -9.54 & 11.1\\
2.2 & -8.52 & 14.1\\
2.4 & -7.71 & 17.0\\
2.6 & -7.04 & 19.8\\
2.8 & -6.49 & 22.4\\\bottomrule
\end{tabular}
\hspace{1cm}
\begin{tabular}{SSS}\toprule
{\textbf{SWR}} & {\textbf{Rückführung}} & {\textbf{\% Reflkt.}}\\\midrule
3 & -6.02 & 25.0\\
4 & -4.44 & 36.0\\
5 & -3.52 & 44.4\\
6 & -2.92 & 51.0\\
7 & -2.5 & 56.3\\
8 & -2.18 & 60.5\\
9 & -1.94 & 64.0\\
10 & -1.74 & 66.9\\
20 & -0.87 & 81.9\\
30 & -0.58 & 87.5\\
40 & -0.43 & 90.6\\
50 & -0.35 & 92.3\\
60 & -0.29 & 93.5\\
80 & -0.22 & 95.1\\
100& -0.17 & 96.2\\\bottomrule
\end{tabular}\end{center}
\end{table}

Eine andere Darstellung des gleichen Zusammenhangs ist im Nomogramm in Abbildung
\ref{fig:rlnomogramm} zu sehen.

\begin{figure}[t]
    \begin{center}
        \includegraphics{figures/rl_swr_nomogram/rl_swr_nomogram.pdf}
    \end{center}
    \caption{Nomogramm des Zusammenhangs zwischen Rückführungsdämpfung (return loss, RL),
    Stehwellenverhältnis (standing wave ratio, SWR) und dem Anteil der reflektierten Leistung (\% Reflkt.).}
    \label{fig:rlnomogramm}
\end{figure}


Die Einfügedämpfung ist ebenfalls ein Leistungsverhältnis: Die Leistung, die
bei eingesetztem Prüfling zu Port ② gelangt wird verglichen mit der Leistung
in Port ②, wenn der Prüfling nicht eingesetzt ist. Dieser Sachverhalt ist in
Abbildung \ref{fig:insertionloss} dargestellt. Die Einfügedämpfung ist dabei
definiert als $d=P_b/P_a$ bzw $10\cdot\log{(d)}$ in Dezibel. Daraus wird erkennbar,
dass ein ``perfekt transparenter'' Prüfling eine Einfügedämpfung von 0~dB
hat. Sorgt ein Prüfling dafür, dass nur noch die halbe Leistung zu Port ②
gelangt, so hat er eine Einfügedämpfung von 3~dB usw. Auch hier wird manchmal
die Einfügedämpfung salopperweise negativ angegeben, was eigentlich falsch ist.

\begin{figure}[H]
    \begin{center}
        \includegraphics{figures/dut_insertionloss/dut_insertionloss.pdf}
    \end{center}
    \caption{Erklärung Einfügedämpfung: Die Leistung $P_a$ ohne Prüfling wird
    verglichen zur Leistung $P_b$ mit Prüfling (device under test, DUT).}
    \label{fig:insertionloss}
\end{figure}

\subsection{Reaktive Lasten}\label{sec:vectors}
Bis jetzt wurden sämtliche Überlegungen anhand von Verhältnissen zwischen
aus- und eingehenden Leistungen gemacht. Messungen dieser Grössen werden
skalare Messungen bezeichnet. Der NanoVNA bietet allerdings die Möglichkeit,
nicht nur skalar, sondern vektoriell zu arbeiten. Das bedeutet, dass er auch
Informationen über die Phase der ein- und ausgehenden Signale verarbeiten kann.

Dies ist im Zusammenhang mit reaktiven Elementen (Spule/Induktivität,
Kondensator/Kapazität, Antenne ausserhalb der Resonanz etc.) wichtig: Reaktive
Elemente haben einen Blindwiderstand, der in aller Regel frequenzabhängig ist.
Dies ist in Abbildung \ref{fig:XRLC} dargestellt: Der Blindwiderstand $X$ eines
Widerstandes $R$ ist $X_R=0~\Omega$ ungeachtet der Frequenz, der Blindwiderstand
einer (idealen) Induktivität $L$ nimmt mit der Frequenz $f$ zu ($X_L=2\pi f L$)
und der Blindwiderstand einer Kapazität $C$ nimmt mit zunehmender Frequenz $f$
ab ($X_C=(2\pi f C)^{-1}$).

Spulen und Kondensatoren sind in Bezug auf ihren Blindwiderstand duale Elemente:
Werden sie in Serie geschaltet, so wirken $X_L$ und $X_C$ entgegengesetzt, und
wenn beide gleich gross sind, dann heben sie sich genau auf. In einem
Schwingkreis oder einer Antenne ist dies genau bei Resonanz erfüllt (vgl. auch
Abbildung \ref{fig:resonanzplot} in Abschnitt \ref{sec:schwingkreis}). Weil
$X_L$ und $X_C$ entgegengesetzt wirken, wird der kapazitive Blindwiderstand
$X_C$ oft negativ angegeben. So wird erkennbar, ob der Blindwiderstand induktiv
oder kapazitiv ist. Auch über diese Konvention lässt sich debattieren.

\begin{figure}
    \includegraphics{figures/reactance/reactance.pdf}
    \caption{Blindwiderstand eines Widerstandes (Bauteil), einer Induktivität ($X_L$) und einer
    Kapazität ($X_C$) von links nach rechts. Der Wirkwiderstand ist jeweils gestrichelt gezeichnet.}
    \label{fig:XRLC}
\end{figure}

\subsection{Phasenverschiebung mit reaktiven Lasten}
Ein Spannungsteiler bestehend aus zwei 50~$\Omega$ (Wirk-)Widerständen
halbiert die Eingangsspannung, bei Gleichspannung wie auch bei Wechselspannung.
Dieser Sachverhalt ist im oberen Teil von Abbildung \ref{fig:phasenverschiebung} festgehalten.
Es wäre nun naheliegend anzunehmen, dass man einen dieser beiden Widerstände
durch eine Induktivität oder Kapazität mit einem Blindwiderstand von 50~$\Omega$
ersetzen könnte und nach wie vor über einen Spannungsteiler verfügt, welcher
die Eingangsspannung halbiert. Das ist allerdings nicht der Fall:
In der unteren Hälfte von Abbildung~\ref{fig:phasenverschiebung} wurde der 50~$\Omega$
Widerstand durch eine Spule ersetzt, welche bei der Testfrequenz von $f=$100~MHz
$X_L=50$~$\Omega$ aufweist. Dennoch weist $U_L$ mehr als die halbe Amplitude von
$U_Q$ auf; ausserdem wird die Phasenverschiebung sichtbar. Diese Beobachtungen
lassen eine Reihe von Schlussfolgerungen zu, die im Weiteren wichtig sein werden:

\begin{itemize}
    \item Die Blindwiderstände der betrachteten Komponenten sind frequenzabhängig,
        Wirkwiderstände sind es nicht.
    \item Blindwiderstände führen zu Phasenverschiebungen, Wirkwiderstände nicht.
    \item Wirk- und Blindwiderstände dürfen nicht ``einfach so'' miteinander
        verrechnet werden, denn das so gefundene Resultat mit dem Spannungsteiler 
        stimmt nicht mit dem Experiment überein. Wenn, dann gibt es strikte und
        offenbar nicht-triviale Regeln, wie gerechnet werden muss.
\end{itemize}

Übrigens hat eine Spule in der Praxis zusätzlich zu Blindwiderstand auch immer
selbst einen Wirkwiderstand, weil der Draht, aus dem sie gewickelt ist,
verlustbehaftet ist. 


\begin{figure}
    \scalebox{0.8}{%
        \includegraphics{figures/divider_resistance_reactance/divider_resistance_reactance.pdf}%
    }
    \caption{Oben: Ein Spannungsteiler halbiert die Spannung: $U_L$ hat die
    halbe Amplitude von $U_Q$. Unten: Phasenverschiebung durch reaktives Element. Bei
einer Frequenz von $f=100$~MHz hat eine Induktivität von 80~nH genau
$X_L=50$~$\Omega$. Dennoch wird die Spannung nicht halbiert, stattdessen wird eine Phasenverschiebung sichtbar.}
    \label{fig:phasenverschiebung}
\end{figure}

\subsection{Das Smith-Diagramm}\label{sec:smith}
Aus dem letzten Abschnitt wird klar: Die betrachteten Bauteile Widerstand, Kondensator und Spule haben Wirk- und
Blindwiderstände, und eine Serienschaltung aus einem Widerstand von
$R=50$~$\Omega$ und einer Spule mit einem Blindwiderstand von $X_L=50$~$\Omega$ hat nicht einen Ersatzwiderstand
von 100~$\Omega$. Bis auf weiteres werden Wirk- und Blindwiderstand als separate Grössen geführt. Ein Bauteil,
oder eine Kombination von Bauteilen, kann auf diese Art einen Wirkwiderstand
$R\ge0$, wie auch einen Blindwiderstand $X$ haben. Ist der Blindwiderstand positiv, so handelt es sich um ein
Induktivität; ein negativer Blindwiderstand beschreibt eine Kapazität. Für ein Bauteil oder eine Schaltung
aus Bauteilen kann also z.B. gelten: $R=200$~$\Omega$, $X=50$~$\Omega$. Diese Grösse wird Impedanz $Z$ genannt
und lässt sich in einem Koordinatensystem als Punkt darstellen, wenn $R$ auf
der horizontalen und $X$ auf der vertikalen Achse abgetragen wird. Das Beispiel
ist in Abbildung \ref{fig:euler} in  blau gezeichnet. 

Auch im Smith-Diagramm wird genau diese Information, also eine Impedanz bestehend aus Wirk- und Blindwiderstand,
als Punkt dargestellt. (Genaugenommen entspricht dieser Punkt einem sogenannten komplexen Reflexionskoeffizienten,
welcher sich aus dieser Impedanz berechnen lässt). Ein Punkt im Smith-Diagramm unterscheidet sich in dieser Hinsicht also nicht
von einem Punkt im eingangs besprochenen Koordinaten-System. Der Unterschied ist lediglich, dass im Smith-Diagramm
die ``Achsen'' eine andere Form haben, welche auf den ersten Blick sehr sonderbar erscheinen mag.
Dabei gelten für die Punkte (und damit für Impedanzen) im Smith-Diagramm folgende Regeln:


\begin{enumerate}
\item Üblicherweise wird das Smith-Diagramm auf 50~$\Omega$ normalisiert, so dass
    der Punkt genau in der Mitte die Impedanz $R=50$~\Ohm und $X=0$~\Ohm aufweist.
\item Auf der Horizontalen in der Mitte des Diagrammes liegen alle Impedanzen mit $X=0$~\Ohm, also alle Impedanzen
    ohne Blindanteil.
\item Der Punkt ganz links auf dieser Horizontalen hat die Impedanz $R=0$~\Ohm, also eine Impedanz ohne Wirk- und Blindwiderstand
    bzw. ein Kurzschluss.
\item Der Punkt ganz rechts auf der gleichen Horizontalen hat die Impedanz $R=\infty$~\Ohm, also eine offene Verbindung.
\item Punkte oberhalb der Horizontalen sind induktive Impedanzen ($X>0$~\Ohm).
\item Punkte unterhalb der Horizontalen sind kapazitive Impedanzen ($X<0$~\Ohm).
\item Punkte auf der umgebenden Kreislinie haben keinen Wirkwiderstand, sie sind also rein induktiv bzw. kapazitiv.
    Je grösser dieser Blindwiderstsand, desto weiter rechts liegen solche Punkte.
\end{enumerate}

\begin{figure}[t]
    \begin{center}
        \includegraphics{figures/complex_plane/complex_plane.pdf}
    \end{center}
    \caption{Darstellung einer Impedanz mit $R=200$~$\Omega$ auf der horizontalen Achse und $X=100$~$\Omega$
    auf der vertikalen Achse (blau), sowie einer Reihe anderer Impedanzen (schwarz).}
    \label{fig:euler}
\end{figure}

Dass ein unendlich grosser Wirkwiderstand nicht von einem unendlich grossen Blindwiderstand unterscheidbar ist,
ist im Einklang mit diesen Regeln, denn diese Impedanzen liegen allesamt Im Punkt ganz rechts.
In Abbildung \ref{fig:smithimpedance} sind die selben Impedanzen zu sehen wie in Abbildung \ref{fig:euler}, nur
sind sie nun in einem Smith-Diagramm dargestellt. Berechtigterweise stellt sich die Frage, wozu das Ganze
gut sein soll?

\begin{figure}
    \includegraphics{figures/complex_smith/complex_smith.pdf}
    \caption{Smith-Diagramm der Impedanzen aus Abbildung \ref{fig:euler}.}
    \label{fig:smithimpedance}
\end{figure}

Werden Komponenten in ein Hochfrequenz-Netzwerk eingefügt, so verändern sie die Impedanz, die ein Generator sieht,
wenn er ins Netzwerk ``hineinschaut'', bzw. die ein VNA mit einer Reflexionsmessung anzeigt. Mit Hilfe des
Smith-Diagrammes lässt sich dieser Einfluss von Netzwerk-Komponenten auf die Eingangsimpedanz des Netzwerkes
sehr einfach darstellen. Für verschiedene solcher Komponenten wird dies im Folgenden verdeutlicht. Die
Effekte sind in Abbildung \ref{fig:smithbigpicture} zusammengefasst.

\newpage % FIXME

\textbf{Widerstände:} Ein Widerstand in Serie erhöht die Impedanz. 
Je grösser der Widerstand, desto mehr strebt die Eingangsimpedanz in Richtung des
Punktes ganz rechts im Smith-Diagramm. Ein zum Netzwerk parallelgeschalteter Widerstand hat den
entgegengesetzten Effekt, die Eingangsimpedanz wird mit abnehmendem
Parallelwiderstand reduziert und strebt zum Punkt ganz links im Smith-Diagramm.

In Abbildung \ref{fig:smithbigpicture} ist der Fall der Serieschaltung jeweils in der linken Spalte,
derjenige der Paralleschaltung in der rechten Spalte abgebildet. Im vorliegenden Beispiel, in dem ein ohmscher 
Widerstand in die Schaltung eingefügt wird, folgen die resultierenden Impedanzen auf Bahnen, die senkrecht auf dem äusseren 
Kreisrand stehen (Diagramme (a) und (b)). 


\textbf{Spulen und Kondensatoren in Serieschaltung:} Eine Spule in Serie ergibt
einen positiven Beitrag zum Blindwiderstand des vorgeschalteten Netzwerks. Das
wird im Smith-Diagramm so dargestellt, dass der Punkt, der die Eingangsimpedanz
des Netzwerks repräsentiert, auf einem Kreisbogen im Uhrzeigersinn zunehmend
gedreht wird. Im Extremfall strebt der Punkt nach rechts auf den äusseren Rand
des Smith-Diagramms.

Ein Kondensator in Serie hat einen negativen Beitrag zum Blindwiderstand des Netzwerks.
Der Punkt, der die Eingansimpedanz des Netzwerks repräsentiert, bewegt sich deshalb
auf dem selben Kreisbogen in die entgegengesetzte Richtung, also im Gegenuhrzeigersinn
bei zunehmender Frequenz oder Kapazität. Im Extremfall bildet der Kondensator einen
Kurzschluss und strebt deshalb dem Punkt ganz links zu (Abbildung \ref{fig:smithbigpicture}c).

\textbf{Spulen und Kondensatoren in Parallelschaltung:} Für Parallelschaltungen
werden die Hilfslinien (Kreisbögen) im Smith-Diagramm gespiegelt. Schaltet man
eine Spule parallel zum bestehenden Netzwerk, strebt der Punkt mit abnehmender
Frequenz oder Induktivität im Gegenuhrzeigersinn zum Punkt ganz links. Ein zum
bestehenden Netzwerk parallelgeschalteter Kondensator verschiebt den Punkt mit
zunehmender Frequenz oder Kapazität entlang der selben Kreislinie im
Uhrzeigernsinn (Abbildung \ref{fig:smithbigpicture}d).

\textbf{Leitungen:} Eine Leitung (z.B. ein Koaxialkabel) transformiert Impedanzen. Eine solche Transformation
entspricht im Smith-Diagramm einem Kreis im Uhrzeigersinn.
Die bekannteste Anwendung dieses Impedanztransformation ist vermutlich der Viertelwellen-Transformator: Wird ein
Koaxialkabel der elektrischen Länge $\lambda/4$ an einem Ende kurzgeschlossen, erscheint am anderen Ende eine
unendlich grosse Impedanz (offener Stromkreis). Im Smith-Diagramm erscheint diese Transformation als Halbkreis,
was in Abbildung \ref{fig:smithbigpicture}e dargestellt ist: Der Halbkreis beginnt beim Kurzschluss
ganz links und endet beim offenen Stromkreis ganz rechts. Ein offener Stromkreis würde auf die selbe Art und
Weise zu einem Kurzschluss transformiert werden. Eine Leitung der Länge $\lambda/2$ entspricht einem Vollkreis
im Diagramm -- abgesehen von Dämpfungseffekten ist der Ausgangspunkt deckungsgleich mit dem Endpunkt. Alle
Beispiele im Diagramm unten links sind Viertelwellen-Transformatoren, deshalb sind ausschliesslich Halbkreise
zu sehen.  Die gestrichelte Linie entspricht einer Leitung mit einem Wellenwiderstand von 100~\Ohm, der
Kreismittelpunkt ist deshalb nicht mehr identisch mit dem Mittelpunkt des Diagrammes. In Abbildung
\ref{fig:smithbigpicture}f ist schliesslich eine lange, verlustbehaftete Leitung zu sehen. Die Verluste führen
dazu, dass mit zunehmender Länge die Eingangsimpedanz immer näher an 50~\Ohm heranrückt, obschon der Abschluss
am anderen Ende weitab von 50~\Ohm liegt.

\begin{figure}
    \begin{center}\includegraphics[width=0.9\textwidth]{figures/smith_big_picture/smith_big_picture.pdf}\end{center}
    \caption{Effekt verschiedenere Komponenten auf die Netzwerk-Impedanz.}
    \label{fig:smithbigpicture}
\end{figure}

\newpage % FIXME
\subsection{Kalibrierung}\label{sec:calibration}

Zur Korrektur von Messabweichungen in Testkabeln und dem Gerät
(Frequenzabhängkeit von Stimulus und Detektor) muss vor jeder Messung eine
Kalibrierung durchgeführt werden. Wie in Abschnitt \ref{sec:smith} erläutert,
werden Impedanzen durch Leitungen transformiert. Eine Kalibrierung macht
auch diesen Effekt rückgängig. Dafür wird ein Kalibrierungs-Standard
(auch Kalibrierungskit genannt) benötigt; in Abbildung \ref{fig:calkit} ist
das Kalibrierungskit abgebildet, das mit dem NanoVNA geliefert wird. Es
besteht aus einer offenen Verbindung (``open''), einem Kurzschluss (``short''),
einem 50~\Ohm Abschluss (``load'') und einem Verbindungsstück (``thru'').
Es gibt eine ganze Reihe von Kalibrierungstechniken, welche z.B. in
\cite{hiebel2007fundamentals}  und \cite{hiebel2008vector} erklärt sind. In
den folgenden zwei Abschnitten werden für Reflexions- und Transmissionsmessung
je eine einfache Kalibrierung vorgestellt.

\begin{figure}[t]
    \includegraphics[width=\textwidth]{figures/calkit.jpg}
    \caption{NanoVNA Kalibrierungs-Standard. Von links nach rechts:
        Offenen Verbindung (``open''), Kurzschluss (``short''),
    50~\Ohm Abschluss (``load''), Verbindungsstück (``thru'').}
    \label{fig:calkit}
\end{figure}

\subsubsection{Reflexionsmessung}
Diese Messung wir mit einer offenen Verbindung (open, O), einem Kurzschluss
(short, S) und einer 50~\Ohm Last (load bzw. match, L/M) durchgeführt. Diese Art von
Kalibrierung wird deshalb auch OSL- bzw. OSM-Kalibrierung genannt. Diese
werden der Reihe nach angeschlossen und das Messgerät über den aktuell angeschlossenen
Abschluss orientiert. Dabei ist es wichtig, dass der Standard dort angeschlossen
wird, wo auch die Messung erfolgen soll. Das Gerät kann so die Transformation
der Messleitung sowie weitere Fehler rückgängig machen.

\subsubsection{Transmissionsmessung}
Bei der Transmissionsmessung wird das Gerät mit einem Verbindungsstück (thru, T) kalibriert,
welcher dann entfernt bzw. durch den Prüfling ersetzt wird. So weiss das  Gerät,
wieviel Energie in welcher Phase vom einen in den anderen Port gelangt, wenn der
Prüfling nicht eingeschleift wird. Diese Messung wird dann als 0~dB bzw. 0° Referenz
genutzt. Jeder Fehler im Verbindungsstück (Dämpfung $>$ 0~dB, Phasengang $\ne$~0°)
wirkt sich direkt auf die Messung aus.


\newpage % FIXME
\section{Bedienung NanoVNA}
Die Struktur der Menüs hat sich in den letzten Jahren stark verändert. Diese Dokumentation
setzt die Firmware von DiSlord in der Version 1.2.20 voraus. Andere Firmwares
oder Firmware-Versionen werden eine leicht unterschiedliche Menüführung aufweisen.

Der NanoVNA wird mit einem Schiebe-Schalter ein- und ausgeschaltet. Beim Einschalten
leuchtet eine blaue LED auf, welche nach dem Ausschalten noch bis zu einer Minute
nachleuchtet. Das Gerät wird über das mitgelieferte USB-C Kabel geladen. Die blaue
LED blinkt, bis der Akku voll ist, anschliessend hört sie auf zu blinken.
% FIXME: Leuchtet konstant oder ist erloschen?

Der grundsätzliche Messablauf ist immer gleich:

\begin{enumerate}
    \item Einstellung der Frequenz (Abschnitt \ref{sec:nanovnafreq})
    \item Kalibrierung (Abschnitt \ref{sec:nanovnacal})
    \item Anzeige von Spuren ein- und ausschalten (Abschnitt \ref{sec:nanovnatraces})
    \item Kanalwahl (Abschnitt \ref{sec:nanovnachannel}) und Einstellung des Anzeigeformates
        (Abschnitt \ref{sec:nanovnaformat})
\end{enumerate}

Bei einer Änderung des Frequenzbereiches muss das Gerät für die bestmögliche Messung
rekalibriert werden.

Weil der Bildschirm etwas klein ist, lohnt sich die Bedienung mit Hilfe eines
Plastik-Stiftes. Der NanoVNA hat ein relativ umfangreiches Menü, welches auf der
hintersten Seite dieser Unterlagen als Referenz abgedruckt ist. Bei der
üblichen Bedienung finden aber immer wieder die selben Menüpunkte Anwendung.
Diese sind im Folgenden erläutert.

\subsection{Einstellen des Frequenzbereiches}\label{sec:nanovnafreq}

\begin{center}\begin{tikzpicture}[font=\sffamily]
    \tikzstyle{menu}=[draw, text width=5em, text centered, minimum height=2em, node distance=2em,on grid]
    \tikzstyle{stimulus}=[fill=stimulus]
    \node[menu,stimulus] (stimulus) {Stimulus};
    \node[menu,stimulus,right=10em of stimulus] (start) {Start};
    \node[menu,stimulus,below of=start] (stop) {Stop};
    \node[menu,stimulus,below of=stop] (center) {Center};
    \node[menu,stimulus,below of=center] (span) {Span};
    \node[menu,stimulus,below of=span] (cwfreq) {CW Freq};
    \node[menu,stimulus,below of=cwfreq] (jogstep) {...};
    \draw[thick,-stealth'] (stimulus) -- (start);
\end{tikzpicture}\end{center}


Der Frequenzbereich wird im Menü ``Stimulus'' eingestellt. Die kann auf zwei
Arten erfolgen:

\begin{itemize}
    \item Mit ``Start'' und ``Stop'' werden Anfangs- und Endfrequenz eingegeben. Eine Anfangsfrequenz von
        430~MHz und eine Endfrequenz von 440~MHz führen dazu, dass das  Gerät im Frequenzbereich von 430~MHz bis 440~MHz misst.
    \item Mit ``Center'' und ``Span'' wird die Mittefrequenz und Bandbreite eingegeben. Eine Mittefrequenz von 435~MHz
        und eine Bandbreite von 10~MHz führen also zur selben Messung wie oben.
\end{itemize}

Mit der Einstellung ``CW Freq'' wird das Gerät auf eine einzige Frequenz fixiert.
Der aktuelle Frequenzbereich wird im Display unten in der linken (Start) bzw.
rechten (Stop) Ecke angezeigt.
Für eine gute Messung muss nach einer Änderung des Frequenzbereiches unbedingt
rekalibriert werden (siehe Abschnitt \ref{sec:nanovnacal}). Eine erneute Kalibrierung
ist nach einer Änderung des Kanales (Abschnitt \ref{sec:nanovnachannel}) oder
des Anzeigeformates (Abschnitt \ref{sec:nanovnaformat}) nicht notwendig.

Egal wie breit oder schmal der Frequenzbereich eingestellt ist, der NanoVNA erfasst in diesem Bereich stets
101 Messpunkte. Insbesondere bei einem grossen Frequenzbereich ist deshalb darauf zu achten, dass zwischen
den Messpunkten keine wichtige Information verloren geht. Mit der Software
``NanoVNA Saver'' (siehe Abschnitt \ref{sec:nanovnasaver}) kann diese Einschränkung umgangen werden.


\subsection{Kalibrierung}\label{sec:nanovnacal}
\begin{center}\begin{tikzpicture}[font=\sffamily]
    \tikzstyle{menu}=[draw, text width=5em, text centered, minimum height=2em, node distance=2em,on grid]
    \tikzstyle{cal}=[fill=cal]
    \node[menu,cal,below of=stimulus] (cal) {Calibrate};
    \node[menu,cal,right=10em of cal] (calibrate) {Calibrate};
    \node[menu,cal,below of=calibrate] (power) {Power};
    \node[menu,cal,below of=power] (calsave) {Save};
    \node[menu,cal,below of=calsave] (reset) {Reset};
    \node[menu,cal,below of=reset] (resetrange) {Rst. Range};
    \node[menu,cal,below of=resetrange] (correction) {Apply};

    \node[menu,cal,right=20em of calibrate] (open) {Open};
    \node[menu,cal,below of=open] (short) {Short};
    \node[menu,cal,below of=short] (load) {Load};
    \node[menu,cal,below of=load] (isoln) {Isoln};
    \node[menu,cal,below of=isoln] (thru) {Thru};
    \node[menu,cal,below of=thru] (done) {...};

    \node[menu,cal,right=10em of calsave] (save0) {Save 0};
    \node[menu,cal,below of=save0] (savei) {...};
    \node[menu,cal,below of=savei] (save4) {Save 4};

    \draw[thick,-stealth'] (cal) -- (calibrate);
    \draw[thick,-stealth'] (calibrate) -- (open);
    \draw[thick,-stealth'] (calsave) -- (save0);
\end{tikzpicture}\end{center}

Nach jeder Änderung des Frequenzbereiches oder des Messaufbaus sollte der
NanoVNA rekalibriert werden. Dafür ist das Menü ``Cal'' vorgesehen. Für die
Kalibrierung wird ein Kalibrierungskit (siehe Abschnitt \ref{sec:calibration}
und Abbildung \ref{fig:calkit}) benötigt. Eine Kalibrierung für die
Reflexionsmessung beinhaltet folgende Schritte:

\begin{enumerate}
    \item Zuerst das Feld ``Reset'' anwählen.
    \item Das Untermenü ``Calibrate'' wählen.
    \item Den offenen Abschluss befestigen und ``Open'' wählen.
    \item Den Kurzschluss befestigen und ``Short'' wählen.
    \item Den 50~\Ohm Abschluss befestigen und ``Load'' wählen.
    \item ``Done'' wählen.
    \item Die Kalibrierung in einer der fünf Speicherplätze speichern.
\end{enumerate}

Eine Kalibrierung für die Transmissionsmessung beinhaltet folgende Schritte:

\begin{enumerate}
    \item Zuerst das Feld ``Reset'' anwählen.
    \item Das Untermenü ``Calibrate'' wählen.
    \item Die Verbindung zwischen den beiden Ports trennen, Port ①  (CH0) mit 50~\Ohm abschliessen und ``Isoln'' wählen.
    \item Mit einem Thru-Verbindungsstück die beiden Ports verbinden und ``Thru'' wählen.
    \item ``Done'' wählen.
    \item Die Kalibrierung in einer der fünf Speicherplätze speichern.
\end{enumerate}

Bei Bedarf ist auch eine Kalibrierung für eine kombinierte Reflexions- und Transmissionsmessung
möglich. In diesem Fall wird im Untermenü ``Calibrate'' jeder Schritt durchgeführt. Mit der
Kalibrierung werden auch die angezeigten Spuren und deren Format, Marker etc. gespeichert.

Auf der linken Seite des Hauptbildschirms wird der jeweils aktuelle Kalibrierungszustand
angezeigt. Tabelle \ref{tab:calibration} erläutert die dort verwendeten Abkürzungen.

\begin{table}
    \begin{center}
        \caption{Abkürzungen zur Anzeige des Kalibrierungszustandes auf der linken Seite des
        Hauptbildschirms.}
        \label{tab:calibration}
        \begin{tabular}{ll}\toprule
            \textbf{Abkürzung} & \textbf{Bedeutung}\\\midrule
            \texttt{C0}, \texttt{C1}, ... & Kalibrierung aus Position 0, 1, etc. ist aktiv.\\
            \texttt{C*} & Aktive Kalibrierung ist nicht gespeichert.\\
            \texttt{c0}, \texttt{c1}, ... & Warnung: Interpolierte Kalibrierung.\\
            \texttt{D} & Kalibrierung mit ``Load'' ist erfolgt.\\
            \texttt{R} & Kalibrierung mit ``Open'' ist erfolgt.\\
            \texttt{T} & Kalibrierung mit ``Thru'' ist erfolgt.\\
            \texttt{X} & Kalibrierung mit ``Isoln'' ist erfolgt.\\
            \texttt{S} & Kalibrierung mit ``Short'' ist erfolgt.\\
            \bottomrule
        \end{tabular}
    \end{center}
\end{table}

\subsection{Trace / Spur anzeigen}\label{sec:nanovnatraces}
\begin{center}\begin{tikzpicture}[font=\sffamily]
    \tikzstyle{menu}=[draw, text width=5em, text centered, minimum height=2em, node distance=2em,on grid]
    \node[menu] (display) {Display};
    \node[menu,right=10em of display] (trace) {Trace};
    \node[menu,right=10em of trace] (trace0) {\colorbox{trace0}{Trace 0}};
    \node[menu,below of=trace0] (trace1) {\colorbox{trace1}{Trace 1}};
    \node[menu,below of=trace1] (trace2) {\colorbox{trace2}{Trace 2}};
    \node[menu,below of=trace2] (trace3) {\colorbox{trace3}{Trace 3}};

    \draw[thick,-stealth'] (display) -- (trace);
    \draw[thick,-stealth'] (trace) -- (trace0);
\end{tikzpicture}\end{center}

Der NanoVNA kann bis zu vier Spuren (engl. Trace) anzeigen. Für jede dieser Spuren
ist es möglich, den Kanal zu wählen (CH0: Reflexionsmessung, CH1:
Transmissionsmessung) und zu bestimmen, auf welche Art und Weise die Mess-Ergebnisse
angezeigt werden. Die Spuren sind farblich codiert und lassen sich im Menü
``Display'' $\longrightarrow$ ``Trace'' ein- und ausschalten. Im selben Menü
wird auch die aktuelle Spur ausgewählt. Die aktuell gewählte Spur ist auf dem
Hauptbildschirm mit einem kleinen Pfeil (``$\blacktriangleright$'') markiert. Die Kanalwahl (Abschnitt
\ref{sec:nanovnachannel}) und die Wahl des Anzeigeformates (Abschnitt \ref{sec:nanovnaformat})
betrifft jeweils diese Spur.

\subsection{Kanalwahl}\label{sec:nanovnachannel}
\begin{center}\begin{tikzpicture}[font=\sffamily]
    \tikzstyle{menu}=[draw, text width=5em, text centered, minimum height=2em, node distance=2em,on grid]
    \node[menu] (display) {Display};
    \node[menu,right=10em of display] (channel) {Channel};
    \node[menu,right=10em of channel] (channel0) {S11 (Refl)};
    \node[menu,below of=channel0] (channel1) {S21 (Thru)};

    \draw[thick,-stealth'] (display) -- (channel);
    \draw[thick,-stealth'] (channel) -- (channel0);
\end{tikzpicture}\end{center}


Der NanoVNA kann sowohl Reflexions- wie auch Transmissionsmessungen durchführen,
welche auch S11 bzw. S21 genannt werden (siehe Abschnitt \ref{sec:ports}). Die beiden Ports sind mit ``CH0'' und ``CH1''
(channel 0 und 1) angeschrieben, wobei der Stimulus stets aus ``CH0'' kommt.
Für eine Reflexionsmessung wird deshalb an ``CH0'', für eine Transmissionsmessung
an ``CH1'' gemessen. Das Pfeil-Piktogramm zwischen den Anschlüssen auf der
Frontblende des NanoVNA erinnert an Abbildung \ref{fig:testset}
und kann bei Unsicherheit zu Rate gezogen werden.

Diese Kanalwahl erfolgt im Menü ``Display'' $\longrightarrow$ ``Channel''.
Die Einstellung in diesem Menü gilt deshalb für die aktuell gewählte Spur.

Für jede Spur erscheint im oberen Teil des Hauptbildschirms in der
entsprechenden Spurfarbe der gewählte Kanal, so dass anhand dieser Angabe
eruiert werden kann, ob eine Reflexions- oder eine Transmissionsmessung
durchgeführt wird.

\subsection{Anzeigeformat der Spur}\label{sec:nanovnaformat} % FIXME check wrap
Der NanoVNA kann das Resultat der Reflexions- und Transmissionsmessung auf verschiedene
Weise anzeigen. Diese Einstellung kann im Menü ``Display'' $\longrightarrow$ ``Format S11 (Refl)''
für die Reflexionsmessung bzw. ``Display'' $\longrightarrow$ ``Format S21 (Thru)''
für die Transmissionsmessung gemacht werden. Die Einstellung gilt für die aktuell gewählte
Spur. Es stehen viele Anzeigeformate zur Verfügung; an dieser Stelle sei auf die Menü-Übersicht
auf der letzten Seite verwiesen. Die wichtigsten Formate sind:

\begin{itemize}
    \item \textbf{LogMag:} Das Resultat wird skalar in dB angezeigt. Bis auf das Vorzeichen sind
        die Angaben deshalb als Einfüge- bzw. Rückführungsdämpfungen zu verstehen.
    \item \textbf{Phase:} Der Phasengang wird angezeigt.
    \item \textbf{SWR:} Aus den skalaren Messresultaten wird das im Amateurfunk
        beliebte Stehwellenverhältnis (standing wave ratio, SWR) berechnet und
        angezeigt. Dies ist vor allem bei Reflexionsmessungen sinnvoll.
    \item \textbf{Smith:} Die Messresultate werden im Smith-Diagramm dargestellt. Auch dies
        ist vor allem bei Reflexionsmessungen sinnvoll.
\end{itemize}

Ausserdem lassen sich Wirk- und Blindwiderstand (Resistance bzw. Reactance) anzeigen und diese Werte
in Induktivitäten und Kapazitäten umrechnen lassen.

\subsection{Marker}
\begin{center}\begin{tikzpicture}[font=\sffamily]
    \tikzstyle{menu}=[draw, text width=5em, text centered, minimum height=2em, node distance=2em,on grid]
    \tikzstyle{marker}=[fill=marker]

    \node[menu,marker] (marker) {Marker};

    \node[menu,marker,right=10em of marker] (selectmarker) {Select M.};
    \node[menu,marker,below of=selectmarker] (markerstart) {Start};
    \node[menu,marker,below of=markerstart] (markerstop) {Stop};
    \node[menu,marker,below of=markerstop] (markercenter) {Center};
    \node[menu,marker,below of=markercenter] (markerspan) {Span};

    \node[menu,marker,right=10em of selectmarker] (marker1) {Marker 1};
    \node[menu,marker,below of=marker1] (markeri) {...};
    \node[menu,marker,below of=markeri] (marker4) {Marker 4};
    \node[menu,marker,below of=marker4] (alloff) {All Off};

    \draw[thick,-stealth'] (marker) -- (selectmarker);
    \draw[thick,-stealth'] (selectmarker) -- (marker1);
\end{tikzpicture}\end{center}

Mit Hilfe von Markern können Messwerte der Spuren numerisch angezeigt werden. Der NanoVNA
unterstützt acht verschiedene Marker. Ist nur einer aktiviert, dann werden alle vier
Spuren auf der Markerfrequenz ausgewertet, jedenfalls sofern die entsprechende
Spur aktiviert ist. Ist mehr als ein Marker aktiviert, dann werden die Marker für die
aktuell gewählte Spur ausgewertet. Die Markierung der aktuell gewählten Spur (``$\blacktriangleright$'')
verschwindet und die Marker erscheinen stattdessen in der Farbe der aktuell gewählten Spur.

% FIXME: Screenshot
Beispiel: Er wird im Frequenzbereich von 10~MHz bis 20~MHz gemessen. Zwei Spuren sind aktiv,
nämlich Spur 1 als Reflexionsmessung (S11) und Spur 2 als Transmissionsmessung (S21). Das Format beider
Spuren ist LogMag. Ein einziger Marker ist aktiv und auf eine Frequenz von
15~MHz eingestellt. Dieser Marker zeigt für die erste Spur die Rückführungsdämpfung und für
die zweite Spur die Einfügedämpfung an, beides bei der eingestellten Frequenz von 15~MHz. Wird
ein zweiter Marker aktiviert, so kann dieser auf einer anderen Frequenz plaziert werden, aber
es werden (je nach aktuell gewählter Spur) entweder die Rückführungsdämpfungen, oder die
Einfügedämpfungen beider Frequenzen angezeigt.

Mit Hilfe eines Stiftes kann der aktuelle Marker verschoben werden. Alternativ kann dazu auch
das kleine Rädchen neben dem Hauptschalter verwendet werden.

\subsection{Vertikale Skalierung und Referenzwert}
Im Menü ``Display'' $\longrightarrow$ ``Scale'' wird mit dem Eintrag ``Scale/Div'' eingestellt,
wieviel dB, Ohm, SWR-Einheiten etc. ein vertikales Häuschen (engl. ``division'') hat. Im selben
Menü kann mit dem Eintrag ``Ref. Pos'' der vertikale Referenzwert gesetzt werden.

\newpage % FIXME
\section{Antennen}\label{sec:antennen}
Unter Funkamateuren ist das beliebteste Messobjekt wohl die Antenne. Sie wird mit einer
Reflexionsmessung charakterisiert, wobei die Kalibrierung am Antennenfusspunkt erfolgt. Oft
wird zwischen dem VNA und der Antenne eine kurze Speiseleitung angeschlossen, deren
Einfluss durch die Kalibrierung wettgemacht werden soll (siehe Abbildung \ref{fig:antennenmessung}).
Erfolgt stattdessen die Kalibrierung und Messung vom Shack aus, so wird die
vielfach lange Speiseleitung mitgemessen. Das ist grundsätzlich nicht falsch,
aber führt zu unterschiedlichen Messergebnissen -- schliesslich wird die
Speiseleitung einmal mitgemessen und ein andermal nicht. Abbildung
\ref{fig:antenna_with_wo_feed} zeigt das SWR einer VHF/UHF Zweibandantenne,
einmal gemessen am Fusspunkt, und einmal gemessen mit dem ganzen Antennensystem
bestehend aus 10~m RG-213 Koaxialkabel.

Für die Kalibrierung am Fusspsunkt ist das mit dem NanoVNA gelieferte Kalibrierungskit
etwas ungünstig -- idealerweise würde man mit dem inversen Kit (also SMA Weibchen)
kalibrieren. So wird durch den zusätzlichen Adapter ein Fehler eingeführt, der jedoch
kaum ins Gewicht fällt, insbesondere wenn der Sachverhalt bekannt ist. Für genauste
Messungen käme ohnehin ein Kalibrierungskit für den passenden Steckertyp, ein spezielles
Messkabel etc. zum Einsatz.

\begin{figure}[H]
    \begin{center}\includegraphics{figures/feednofeed/feednofeed.pdf}\end{center}
    \caption{SWR-Messung einer VHF/UHF Zweibandantenne am Fusspunkt (ausgezogen) sowie im Shack nach 10~m
    RG-213 Koaxialkabel (gestrichelt). Die Antenne strahlt trotz tieferem SWR keineswegs mehr Leistung ab.}
    \label{fig:antenna_with_wo_feed}
\end{figure}

Ebenfalls wichtig ist die Erkenntnis, dass die Charakterisierung einer Antenne mit einem VNA
nicht abschliessend klärt, wie ``gut'' eine Antenne oder ein Antennensystem (mit Speiseleitung)
ist. Dies einerseits, weil der Begriff ``gut'' je nach Anwendungsfall ganz andere Anforderungen
an die Antenne stellt (Rundstrahler vs. Richtwirkung, steiler Abstrahlwinkel für NVIS vs.
flacher Abstrahlwinkel für DX, Monoband- vs. Multiband-Antennen usw.). Ein VNA
kann hier nicht wissen, welche dieser Eigenschaften erwünscht sind. Andererseits -- und dieser
Aspekt ist recht subtil -- misst ein VNA im Reflexionsmodus einfach, wieviel vom Stimulus
zurück in den Port reflektiert wird. Was mit dem nicht reflektierten Teil geschieht, kann
das Gerät nicht eruieren. Vielleicht verheizt ein verlustbehaftetes Anpassungsglied am
Antennenfusspunkt einen beachtlichen Teil der Leistung. Die Energie wird in diesem Fall nicht
reflektiert, gelangt aber auch nicht in die Antenne. Möglich ist auch, dass beim Versuch,
den Impedanzsprung von Speiseleitung zu Antenne mit einem Tuner im Shack anzupassen, zu
beachtlichen Verlusten auf der Speiseleitung führen \cite{walraven2006understanding}. Es ist
auch möglich, dass ein Anpassungsnetzwerk aus Transformations- und Stichleitungen die
Sendeleistung in Wärme umwandelt \cite{doberenz2019swrgut}. In den beiden letzten Fällen
gelangt die Sendeleistung gar nicht zur Antenne, der VNA merkt davon jedoch nicht. Denn
jede Energie, die auf dem Weg zur Antenne in Wärme umgewandelt wird, kann nicht reflektiert
werden.

\begin{figure}[H]
    \begin{center}
        \includegraphics{figures/antenna_model/antenna_model.pdf}
    \end{center}
    \caption{Ein einfaches Antennenmodell: Der Wirkwiderstand setzt sich zusammen aus $R_\text{strahl}$
    und $R_\text{ohm}$, aber nur die Leistung in $R_\text{strahl}$ wird von der Antenne abgestrahlt.}
    \label{fig:antennenmodell}
\end{figure}

Doch auch wenn die Sendeleitung die Antenne erreicht, muss sie nicht unbedingt
abgestrahlt werden. Ein einfaches Antennen-Modell ist in Abbildung \ref{fig:antennenmodell}
dargestellt. Wenn die Antenne in Resonanz ist, so heben sich die Blindwiderstände von
$L$ und $C$ genau auf und die Impedanz der Antenne entspricht dem Wirkanteil
$R_\text{strahl}+R_\text{ohm}$. $R_\text{strahl}$ ist dabei der Strahlungswiderstand und
$R_\text{ohm}$ sind die übrigen Widerstände, z.B. der verwendeten Antennendrähte oder
verantwortlich für den Bodenverlust. Nur die Leistung in $R_\text{strahl}$ wird
abgestrahlt. $R_\text{strahl}$ kann unter Umständen aber bloss einen kleinen
Anteil an der Gesamtimpedanz haben, worauf hin die Antenne ineffizient ist
\cite{smith1947performance}.  Ein VNA sieht bestenfalls die Summe
$R_\text{strahl}+R_\text{ohm}$ und kann nicht eruieren, welcher Anteil der
eingehenden Leistung abgestrahlt wird.

Ein weiterer Aspekt, der bei der Messung mit dem VNA nicht
berücksichtigt wird, sind thermische Effekte: Wenn ein Bauteil in der Speiseleitung
(z.B. eine Mantelwellensperre) aufgrund von Leistungsdissipation warm wird, kann es seine
elektrischen Eigenschaften verändern. Ein VNA mit seiner geringen Ausgangsleistung kann
die Erwärmung natürlich nicht herbeiführen, so dass diese Effekte verborgen bleiben.

Abschliessend sei auf Abbildung \ref{fig:antennenmessung} verwiesen, welche die Charakterisierung
einer Antenne mit einem kurzen Messkabel schematisch zeigt. Wie bereits erläutert erfasst
die Messung lediglich einen Teilaspekt, insbesondere bleiben Gewinn und Effizienz der
Antenne weiterhin unbekannt.

\newpage % FIXME
\minisec{Vorgehen mit dem NanoVNA:}

\begin{enumerate}
    \item Frequenzbereich einstellen.
    \item Kalibrierung für Reflexionsmessung am Fusspunkt.
    \item Antenne anschliessen (Abbildung \ref{fig:antennenmessung}).
    \item Anzeigeformat (``Display'' $\longrightarrow$ ``Format''): LogMag oder SWR.
    \item Kanalwahl (``Display'' $\longrightarrow$ ``Channel''): CH0 (Reflexionsmessung).
\end{enumerate}

\begin{figure}[H]
    \includegraphics[width=\textwidth]{figures/illustration_antenna.png}
    \caption{Illustration der Charakterisierung einer Antenne mit einem kurzen Messkabel. Die Kalibrierung erfolgt am Fusspunkt.}
    \label{fig:antennenmessung}
\end{figure}

\newpage % FIXME
\section{Impedanzmessungen}\label{sec:impedance}
Der NanoVNA kann die Impedanz von Widerständen, Spulen, Kondensatoren, Abschlüssen etc.
bestimmen, da er in der Lage ist, sowohl Amplitude, wie auch Phasenverschiebung zu
quantifizieren. Im Gegensatz zu einem LCR-Meter kann der VNA auf der Frequenz messen,
auf der das Bauteil schlussendlich betrieben wird. Es wäre beispielsweise denkbar,
dass Streukapazitäten zwischen den Windungen einer Spule auf dieser Betriebsfrequenz
nicht mehr vernachlässigbar sind. Was im LCR-Meter bei einigen 100~kHz nach einer
ausgezeichneten Spule aussieht, wird dann bei höheren Frequenzen zu einem Schwingkreis
und erfüllt seinen Zweck nicht mehr.

Mit seiner Quell-Impedanz von 50~\Ohm entsteht bei einer
Reflexionsmessung der Spannungsteiler aus Abbildung
\ref{fig:phasenverschiebung}. So kann das Gerät die Impedanz des Prüflings
berechnen und, unter Zuhilfenahme der momentanen Frequenz des Stimulus, bei
Bedarf daraus sogar die Induktivität bzw. Kapazität berechnen.

Es gibt drei gängige Wege, die Impedanz $Z$ eine Bauteils mit einem VNA zu messen:
(1) Eine Reflexionsmessung, (2) eine Transmissionsmessung mit der unbekannten
Impedanz in Serie, und (3) eine Transmissionsmessung mit der unbekannten
Impedanz parallel zu den Ports. Diese drei Varianten sind in Abbildung
\ref{fig:impedancemeasurement} gezeigt. Falls eine genaue Messung gewünscht ist,
kann ein unbekanntes $L$ mit einem bekannten Referenz-$C$ in Serie geschaltet
und die Resonanzfrequenz des so entstandenen Schwingkreises ermittelt werden.
Aus dieser Resonanzfrequenz kann anschliessend das unbekannte $L$ berechnet werden.
Diese Methode ist genauer als die anderen drei Ansätze -- bei einem unbekannten
$C$ würde analog ein bekanntes Referenz-$L$ verwendet werden.

\begin{figure}[H]
    \begin{center}
        \scalebox{0.8}{\includegraphics{figures/variants_impedance/variants_impedance.pdf}}
    \end{center}
     \caption{Drei Varianten zur Messung einer Unbekannten Impedanz $Z$. Von
         links nach rechts: (1) Reflexionsmessung, (2) Transmissionsmessung mit $Z$ in
     Serie, (3) Transmissionsmessung mit $Z$ parallel zu den Ports.}
    \label{fig:impedancemeasurement}
\end{figure}

Gemäss \cite{tech2018performing} ist Variante (1), also die Reflexionsmessung, generell
empfohlen. Bei sehr grossen Impedanzen führt Variante (2), also Transmissionsmessung
mit $Z$ in Serie, zu genaueren Resultaten, und bei sehr kleinen Impedanzen
ist Variante (3), also Transmissionsmessung mit parallelem $Z$, zu bevorzugen.

Für eine genaue Messung muss das zu charakterisierende Bauteil in eine
Test-Vorrichtung (engl. test fixture) montiert werden. Die Qualität der Messung
ist dabei dominiert von der Qualität dieser Vorrichtung; die Qualität des
verwendeten Messgerätes ist bei einer ungeeigneten Vorrichtung effektiv
zweitranging. Der Anspruch an die Vorrichtung steigt mit zunehmender Frequenz,
denn kleine parasitäre Komponenten gewinnen dann an Einfluss. Abbildung
\ref{fig:testfixtures} zeigt verschiedene Ansätze für solche Vorrichtungen.
Oben links wurde aus SMA-Steckern und Krokodilklemmen eine vielseitig
einsetzbare Apparatur gebaut. Insbesondere bei höheren Frequenzen ist dieser
Ansatz jedoch völlig ungenügend. Oben rechts ist eine bessere Alternative zu
sehen: Auf eine freiliegende 50~\Ohm Leiterbahn kann das unbekannte
Bauteil aufgelötet werden. Besonders raffiniert ist der Aufbau von Larry
Benko), der aus Koaxialbuchsen einfach gebaut werden kann
\cite{benko2020impedance}.  Wie im unteren Teil von Abbildung
\ref{fig:testfixtures} zu sehen, kann ein Bauteil zwischen zwei rechtwinklig
zueinander liegenden N-Buchsen auf die drei oben genannten Arten (A-C für (1),
A-B für (2) und AB-C für (3)) montiert werden.

\minisec{Vorgehen mit dem NanoVNA (Reflexionsmessung, Variante (1)):}

\begin{enumerate}
    \item Test-Vorrichtung befestigen (z.B. Klemmen).
    \item Frequenzbereich einstellen.
    \item Kalibrierung für Reflexionsmessung: Klemmen kurzschliessen für Kurzschluss, 50 Ohm Widerstand
        einsetzen für Last.
    \item Bauteil in Vorrichtung einsetzen (Abbildung \ref{fig:illustrationimpedance})
    \item Anzeigeformat (``Display'' $\longrightarrow$ ``Format''): Smith.
    \item Kanalwahl (``Display'' $\longrightarrow$ ``Channel''): CH0 (Reflexionsmessung).
    \item Marker verwenden und Werte ablesen.
\end{enumerate}

\begin{figure}[H]
    \includegraphics[width=\textwidth]{figures/illustration_impedance.png}
    \caption{Illustration der Impedanzmessung reaktiver Bauelemente mit Variante~(1) gemäss Abbildung \ref{fig:impedancemeasurement}.}
    \label{fig:illustrationimpedance}
\end{figure}

Ein einfaches Experiment illustriert die Notwendigkeit einer guten
Testvorrichtung: Eine einfache Spule wird über zwei Litzen mit dem Port ①  des
NanoVNA verbunden. Der Blindwiderstand bzw. die daraus berechnete Induktivität
wird gemessen, wobei die Lage der Litzen zueinander verändert wird. Der Effekt
ist beeindruckend. 

\begin{figure}\begin{center}
    \includegraphics[height=36mm]{figures/klemmen.jpg}\hfill
    \includegraphics[height=36mm]{figures/impedanzpcb.jpg}

    \includegraphics[width=\textwidth]{figures/w0qe_fixture.png}
    \caption{Oben links: Klemmen zur Impedanzmessung. Oben rechts: Leiterplatte zur Impedanzmessung
        mit 50~\Ohm Spur und eingesetztem Bauteil gemäss Messvariante (3). Unten: Vorrichtung von Larry Benko zur Impedanzmessung mit einem VNA \cite{benko2020impedance}.
    Ein zu charakterisierendes Bauteil wird gemäss einer der drei Varianten aus Abbildung \ref{fig:impedancemeasurement}
    an die Koaxialbuchsen gelötet.}
    \label{fig:testfixtures}
\end{center}\end{figure}

\newpage % FIXME
\section{Schwingkreise, Resonanzfrequenzen, Anpassung}\label{sec:schwingkreis}
Es gibt mehrere Gründe, sich mit der Messung von Schwingkreisen
auseinanderzusetzen. Der einfachste besteht darin, die Resonanzfrequenz
eines solchen zu ermitteln -- dies schliesst auch die Eigenresonanzfrequenz von
Bauteilen ein. Dann ist es möglich, Spulen und Kondensatoren genauer zu
bestimmen, indem sie zu einem Schwingkreis geschaltet werden: Ist die
Induktivität einer Spule gesucht, wird diese Spule mit einem Kondensator
mit bekannter Kapazität zu einem Schwingkreis verschaltet, die Resonanzfrequenz
gemessen und mit der gemessenen Resonanzfrequenz $f$ und der bekannten
Kapazität $C$ die gesuchte Induktivität $L$ berechnet. Schliesslich sind
Schwingkreise einfache Modelle von Antennen.

\subsection{Schwingkreis und Resonanzfrequenz}
Ein Schwingkreis ergibt sich, wenn ein Widerstand $R$, eine Induktivität $L$
und eine Kapazität $C$ in Serie geschaltet werden (Serienschwingkreis, siehe
Abbildung \ref{fig:schwingkreis}). Es besteht auch die Möglichkeit, diese drei
Bauteile parallel zu schalten (Parallelschwingkreis).

\begin{figure}[H]
    \begin{center}
        \includegraphics{figures/tank_circuit/tank_circuit.pdf}
    \end{center}
    \caption{Ein Serienschwingkreis bestehend aus einer Spule/Induktivität $L$,
    einem Kondensator/Kapazität $C$ und einem Widerstand $R$.}
    \label{fig:schwingkreis}
\end{figure}

Bei einer bestimmten Frequenz, der Resonanzfrequenz $f_r$, heben sich die
Blindwiderstände von $L$ und $C$ genau auf. Es gilt:

$$
f_r = \frac{1}{2\pi\sqrt{L\cdot C}}
$$

Sind also $L$ und $C$ bekannt, so lässt sich $f_r$ berechnen, ebenso lässt ich
$L$ berechnen, falls $C$ und $f_r$ bekannt sind, etc. Abbildung \ref{fig:resonanzplot}
zeigt den Blindwiderstand (links, gestrichelte Linie) im Serienschwingkreis als Funktion der Frequenz. Es
handelt sich dabei um die Darstellung der Grösse $X_L-X_C$ aus Abbildung \ref{fig:XRLC}.
Unterhalb der Resonanzfrequenz ist der Blindwiderstand negativ, der
Schwingkreis hat also eine kapazitive Komponente bzw. der Kondensator
dominiert. Oberhalb der Resonanzfrequenz ist der Blindwiderstand positiv, der
Schwingkreis ist induktiv bzw. die Spule dominiert. Bei einer Resonanzfrequenz
von $f_r\approx$~5~MHz ist der Blindwiderstand 0~$\Omega$, lediglich $R=50$~$\Omega$
ist am Eingang sichtbar. Ein Abschluss von 50~$\Omega$ entspricht einer perfekten
Anpassung und deshalb entsteht bei dieser Frequenz überhaupt kein Rückfluss.
Die selben Sachverhalte sind auf der rechten Seite von Abbildung
\ref{fig:resonanzplot} im Smith-Diagramm erkennbar. Die Analogie zu Verhalten
einer Antenne im Umfeld ihrer Resonanzfrequenz ist offensichtlich.
\begin{figure}
    \begin{center}\includegraphics[scale=0.8]{figures/resonance_plots/resonance_plots.pdf}\end{center}
\caption{Links: Rückfluss und Blindwiderstand des Schwingkreises aus Abbildung \ref{fig:schwingkreis} mit 
$L$=1~$\mu$H, $C$=1~nF, $R$=50~$\Omega$. Rechts: Smith-Diagramm der Eingangsimpedanz dieser Schaltung.}
\label{fig:resonanzplot}
\end{figure}

\subsection{Anpassung}
Manchmal ist es wünschenswert, eine Impedanz in eine andere umzuwandeln. Dies ist beispielsweise der Fall,
wenn ein hochomiges Bauteil in einem 50~$\Omega$ System verwendet werden soll, oder wenn eine Last
(z.B. Antenne) auf der Zielfrequenz eine Impedanz aufweist, die fernab der Systemimpedanz liegt und eine
genügende Leistungsübertragung nicht erbracht wird. In diesem Fall kommen Transformatoren zur Impedanzwandlung
(siehe Abschnitt \ref{sec:impedanztrafo}), speziell konfigurierte Leitungen
oder Anpass-Netzwerke zum Einsatz. Letztere bestehen aus Kombinationen von Kapazitäten und Induktivitäten,
mit denen die Impedanzanpassung vorgenommen wird. Die einfachste Möglichkeit hierfür ist der in Abbildung
\ref{fig:lmatch} gezeigte L-Match.

\begin{figure}[H]
    \begin{center}\includegraphics{figures/matching_circuits/matching_circuits.pdf}\end{center}

    \caption{L-Match: Verschiedene Anordnungen von Kapazitäten und Induktivitäten zur Anpassung der Impedanz.}
    \label{fig:lmatch}
\end{figure}

Keine dieser Schaltungen ermöglicht die Anpassung einer beliebigen Impedanz zu
einer anderen beliebigen Impedanz. Es ist allerdings möglich, die Bauteilwerte
variabel zu gestalten und mehrere L-Matches zusammenzuschalten, um die
Anpassungemöglichkeiten zu erweiterten. Ein in diesem Sinn beliebter Ansatz 
ist der in Abbildung \ref{fig:tmatch} dargestellte T-Match.

\begin{figure}[H]
    \begin{center}\includegraphics{figures/t_match/t_match.pdf}\end{center}
    \caption{T-Match: Beliebte Schaltung zur Impedanzanpassung (Matchbox/Antennen-Tuner). Es handelt sich um einen
    Verbund zweier variabler L-Matches aus Abbildung \ref{fig:lmatch}.}
    \label{fig:tmatch}
\end{figure}

\minisec{Vorgehen mit dem NanoVNA:}

Die Messung des Verhaltens des Schwingkreis wird genau gleich durchgeführt wie die
Impedanzmessung in Abschnitt \ref{sec:impedance} (Reflexionsmessung). Statt
eines einzelnen Bauteils wird der ganze Schwingkreis angeschlossen.

\newpage % FIXME
\section{Filter, Dämpfungsglieder, Koppler und Ähnliches}\label{sec:filter}
Filter lassen einige Frequenzen des Spektrums passieren (Passband), während
sie andere Frequenzen reflektieren oder dissipieren. Die Pass- und
Sperr-Charakteristika von Filtern werden üblicherweise mit einer
Transmissionsmessung bestimmt. Unter Umständen ist allerdings auch eine
Reflexionsmessung zielführend, z.B. wenn ein Duplexer justiert werden muss.
Handelt es sich bei dem Filter nicht um ein 50~$\Omega$ System (z.B. ein
Keramik-Filter), muss die Fehlanpassung berücksichtigt werden.

Zu beachten ist wie üblich, dass keine Einfügedämpfungen gemessen werden
können, welche den Dynamikbereich des VNAs überschreiten.

\subsection{Koaxiale Stub-Filter}\label{sec:stubfilter}
Eine Leitung -- z.B. ein Koaxialkabel -- der Länge $\lambda/4$ hat besondere
Eigenschaften: Ein Kurzschluss am einen Ende sieht vom anderen Ende aus wie
eine offene Verbindung; eine offene Verbindung am einen Ende sieht vom anderen
Ende aus wie ein Kurzschluss. Die Impedanz wird also transformiert, die
Struktur wird deshalb auch Viertelwellen-Transformator genannt. Im Smith-Diagramm
wird eine Abschlussimpedanz am Ende der Leitung in einem Halbkreis im Gegenuhrzeigersinn
rotiert (siehe Abschnitt \ref{sec:smith}). Zwei $\lambda/4$-Leitungen
hintereinander entsprechen einer Leitung der Länge $\lambda/2$, im
Smith-Diagramm erfolgen zwei Rotationen um je einen Halbkreis bzw. eine
Rotation um einen Vollkreis: Die $\lambda/2$-Leitung transformiert eine
beliebige Impedanz (abgesehen von Verlusten im Kabel) auf sich selbst.

\begin{figure}[H]
    \begin{center}\includegraphics{figures/stub/stub.pdf}\end{center}
\caption{Einfügedämpfung eines Stub-Filters der Länge 2.5~m. Die ausgezogene Linie beschreibt den Filterverlauf
eines kurzgeschlossenen Stubs, wärend die gestrichelte Linie den Filterverlauf eines Stubs mit offenem Ende beschreibt.}
\label{fig:quarterwaveplot}
\end{figure}

Diese Eigenschaft kann genutzt werden, um mit Koaxialkabel einen relativ
schmalbandigen Sperr-Filter (Notch) zu implementieren (siehe Abbildung
\ref{fig:quarterwaveplot}). Dazu wird, wie in Abbildung
\ref{fig:quarterwavestub} gezeigt, mit einem T-Stück die $\lambda/4$-Leitung
parallel geschaltet. Als Alternative zum T-Stück kann auch eine Vorrichtung wie
die Platine in Abbildung \ref{fig:testfixtures} genutzt werden -- dies ist vor
allem dann sinnvoll, wenn die $\lambda/4$-Leitung ohne Stecker auskommen soll.

Die Viertelwellen-Transformation mag etwas verwirrend erscheinen, ein Zahlenbeispiel
soll deshalb an dieser Stelle für etwas Klarheit sorgen: Für eine Frequenz von
30~MHz ist die Wellenlänge ca. $\lambda$=10~m. Eine Halbwellenleitung hat deshalb
die Länge $\lambda/2$=5~m und eine Viertelwellenleitung $\lambda/4$=2.5~m. Ein
Kurzschluss am Ende dieser $\lambda/4$ Leitung wird deshalb bei 30~MHz zu einer
offenen Verbindung transformiert, welche die beiden anderen am T-Stück
angeschlossenen Leitungen keinen Einfluss hat. Bei der doppelten Frequenz, also
60~MHz, hat diese Leitung aber nicht mehr die Länge  $\lambda/4$, sondern
$\lambda/2$! Da die Leitung am Ende nach wie vor kurzgeschlossen ist, wird dieser
Kurzschluss bei 60~MHz also unmittelbar in das T-Stück transformiert, und ein
Kurzschluss führt zu einer Totalreflexion: Die Struktur sperrt bei 60~MHz. Das
selbe Phänomen tritt auch bei 120~MHz, 180~MHz etc. auf. Die Einfügedämpfung
ist in Abbildung \ref{fig:quarterwaveplot} dargestellt. Die gestrichelte Linie
zeigt ein Stub mit offenem (anstelle eines kurzgeschlossenen) Ende. Die Sperrwirkung
erfolgt dort bereits bei 30~MHz, da bei dieser Frequenz das offene Ende in einen
Kurzschluss transformiert wird.

\begin{figure}[t]
    \reflectbox{\includegraphics[width=\textwidth]{figures/illustration_stub.jpg}}
    \caption{Transmissions-Messung eines Stub-Filters. Das Ende des Stubs kann
    (je nach gewünschtem Verhalten) offen oder kurzgeschlossen sein.}
    \label{fig:quarterwavestub}
\end{figure}

Das Vorgehen für die Messung eines Stub-Filters mit dem NanoVNA unterscheidet
sich nicht von den übrigen Filtermessungen in diesem Abschnitt. Weil aber
interessante leitungstheoretische Aspekte eine Rolle spielen, werden diese
Stub-Filter hier separat behandelt.

\subsection{Dämpfungsglieder, Koppler und Isolation}
Die Dämpfung oder Isolation zwischen zwei Anschlüssen von Dämpfungsgliedern,
Stufendämpfungsgliedern, Splitter-Combinern, Richt-, Hybrid- und anderer Koppler
kann ebenfalls mit einer Transmissionsmessung ermittelt werden. Dazu wird der VNA auf den
gewünschten Frequenzbereich eingestellt, mit einem Verbindungsstück kalibriert
und dann eingeschleift. Damit unterschiedet sich diese Messung nicht von derjenigen
von Filtern.

Bei vollständiger Isolation wäre die Einfügedämpfung unendlich gross. Trotzdem
zeigt ein VNA einen endlichen Wert an. Wie bereits mehrfach erwähnt, kann
keine Dämpfung/Isolation gemessen werden, welche diesen endlichen Wert übersteigt.

\minisec{Vorgehen mit dem NanoVNA:}
Für alle Messungen in diesem Abschnitt \ref{sec:filter} gilt folgendes Vorgehen:

\begin{enumerate}
    \item Frequenzbereich einstellen.
    \item Messkabel anschliessen und mit Thru-Adapter verbinden.
    \item Kalibrierung für Transmissionsmessung durchführen.
    \item Filter einschleifen.
    \item Anzeigeformat (``Display'' $\longrightarrow$ ``Format''): LogMag.
    \item Kanalwahl (``Display'' $\longrightarrow$ ``Channel''): CH1 (Transmissionsmessung).
\end{enumerate}

Je nach Situation kann eine zusätzliche Reflexionsmessung der Filterports zielführend sein.

\newpage % FIXME
\section{Mantelwellensperren}
Eine Mantelwelle ist eine elektromagnetische Welle, die sich auf dem Aussenleiter (Mantel) eines
Koaxialkabels ausbreitet. Dies ist in aller Regel aus verschiedenen Gründen
unerwünscht. Um die Mantelwelle zu unterbinden, wird eine Mantelwellensperre
eingesetzt. Diese Mantelwellensperre soll für Gegentaktsignale wie das
Empfangssignal von der Antenne zum Empfänger und das Sendesignal vom Sender
zur Antenne durchlässig sein; für Gleichtaktsignale wie die Mantelwelle soll
die Mantelwellensperre nicht durchlässig sein.

Die Messung einer Mantelwellensperre hat deshalb drei Aspekte:
(1) Durchlässigkeit von Gegentaktsignalen;
(2) Dämpfung von Gleichtaktsignalen;
(3) Verhalten unter Last (Erwärmung etc.).
Mit einem VNA werden typischerweise nur die ersten beiden Aspekte erfasst, die
Erwärmung unter Last kann z.B. mit einem Thermometer oder einer Wärmebildkamera
etc. erfasst werden und wird an dieser Stelle nicht besprochen.

Die \textbf{Gegentaktmessung} ist einfach: Der VNA wird für eine Transmissionsmessung
kalibriert, die Sperre wird eingeschleift und die Einfügedämpfung wird
gemessen. Eine gute Mantelwellensperre sollte bei dieser Messung eine geringe
Einfügedämpfung aufweisen.

Für die \textbf{Gleichtaktmessung} wird die Mantelwellensperre auf eine besondere
Art und Weise mit dem VNA verbunden: Der Eingang wird mit dem Stimulus,
der Ausgang mit dem detektierenden Port verbunden. Allerdings werden die
beiden Leiter der Leitung jeweils kurzgeschlossen und mit dem
Innenleiter der Ports verbunden; die beiden Aussenleiter der Ports werden
kurzgeschlossen. Wenn die so präparierte Mantelwellensperre als diskretes
Bauteil betrachtet wird, so entspricht diese Messung der seriellen
Transmissionsmessung dieses Bauteils -- also Messvariante (2) aus
Abschnitt \ref{sec:impedance}. Eine gute Mantelwellensperre
sollte bei dieser Messung eine hohe Einfügedämpfung haben.

Für diese Messung ist eine Vorrichtung notwendig, um die Aussenleiter der
beiden VNA-Ports kurzschliesst. Die Mantelwellensperre kann dann über Klemmen
mit den beiden Innenleitern verbunden werden. (Siehe Abbildung
\ref{fig:illustration_choke} für eine Vorrichtung mit Klemmen).

\minisec{Vorgehen mit dem NanoVNA:}
\begin{enumerate}
    \item NanoVNA für Gegentaktmessung vorbereiten wie in Abschnitt \ref{sec:filter} beschrieben.
        (Frequenz einstellen, Kalibrierung für Transmissionsmessung mit Thru, Kanalwahl ``CH1'',
        Anzeigeformat ``LogMag''.)
    \item Mantelwellensperre einschleifen, d.h. wie im normalen Gebrauch anschliessen.
    \item NanoVNA für Gleichtaktmessung vorbereiten: Messvorrrichtung montieren und für
        Transmissionsmessung rekalibrieren -- die Thru-Kalibrierung erfolgt mit kurzgeschlossener
        Vorrichtung.
    \item Dann Gleichtaktmessung wie in Abbildung \ref{fig:illustration_choke} durchführen.
\end{enumerate}

\begin{figure}
    \includegraphics[width=0.7\textwidth]{figures/illustration_w2du_short.png}
    \includegraphics[width=\textwidth]{figures/illustration_DG0SA.png}
    \caption{Gleichtaktmessung von Mantelwellensperren. Die Mantelwellensperre
        ist in Serie zwischen den beiden Ports geschaltet. Oben: Mantelwellensperre
        nach W2DU \cite{maxwell1983w2du}. An den rot eingezeichneten Stellen sollten die
        beiden Leiter kurzgeschlossen werden; idealerweise ist dies Teil der Messvorrichtung.
        Unten: Mantelwellensperre nach DG0SA.}
    \label{fig:illustration_choke}
\end{figure}

\newpage % FIXME
\section{Schwingquarze}
Ein Schwingquarz ist ein Bauteil, welches zur Erzeugung von Schwingungen oder
als Filter verwendet werden kann. Ein vereinfachtes Ersatzschaltbild ist in
Abbildung \ref{fig:quarzersatz} dargestellt. 

\begin{figure}[H]
    \begin{center}
        \includegraphics{figures/quartz_model/quartz_model.pdf}
    \end{center}
    \caption{Vereinfachtes Ersatzschaltbild eines Schwingquarzes.}
    \label{fig:quarzersatz}
\end{figure}

Im Ersatzschaltbild ist zu erkennen, dass der Schwingquarz aus einem
Serien-Schwingkreis ($L_1$, $C_1$, $R_1$) und einer dazu parallelen Kapazität
C$_0$ besteht. Der Quarz hat aufgrund dieser Schaltung zwei Resonanzstellen:
Wie in Abbildung \ref{fig:quarzidealplot} gezeigt, liegt die erste beim
Nulldurchgang des Blindwiderstandes. Die zweite liegt vor, wenn der Blindwiderstand
unendlich gross wird. Diese beiden Resonanzstellen werden Resonanzfrequenz $f_r$
bzw. Antiresonanzfrequenz $f_a$ genannt. $f_r$ ist stets etwas geringer als
$f_a$. Für die Frequenz des Schwingquarzes wird $f_r$ angegeben, welche der
Resonanzfrequenz des Serienschwingkreises aus $L_1$, $C_1$ und $R_1$
entspricht:

$$
f_r = \frac{1}{2\pi\sqrt{L_1\cdot C_1}}
$$

Mit einer Transmissionsmessung lassen sich $f_r$ und $f_a$ messen, wobei besonders $f_a$ von parasitären Komponenten
stark beeinflusst werden kann. Der Quarz wird für die Messung in die Zusatzapparatur eingespannt, die auch für die
Charakterisierung der Mantelwellensperre benutzt worden ist. Dabei müssen folgende Punkte beachtet werden:

\begin{itemize}
    \item Weil Schwingquarze sehr schmalbandig sind und der NanoVNA nur 101 Punkte aufnimmt, muss zur Verhinderung grosser Messfehler ein entsprechend kleiner Frequenzbereich ausgewählt
        oder auf die Software ``NanoVNA Saver'' (siehe Abschnitt \ref{sec:nanovnasaver}) zurückgegriffen werden.
    \item Weil das Ersatzschaltbild aus Abbildung \ref{fig:quarzersatz} lediglich eine Vereinfachung darstellt, werden bei der Messung in der Praxis oberhalb von $f_r$ Nebenresonanzen auftreten.
\end{itemize}

Es gibt weitere, teilweise bessere Methoden, einen Schwingquarz zu charakterisieren (mit einem VNA und auch mit
anderen Gerätschaften.) Für eine gute Übersicht sei auf \cite{kortke2002} verwiesen.

\begin{figure}[H]
\begin{center}
    \includegraphics{figures/quartz_plot/quartz_plot.pdf}
\end{center}
\caption{Einfügedämpfung (ausgezogen) und Blindwiderstand $X$ (gestrichelt, negativ wenn kapazitiv) der Ersatzschaltung
aus Abbildung \ref{fig:quarzersatz}. Es sind zwei Resonanzstellen sichtbar.}
\label{fig:quarzidealplot}
\end{figure}

\minisec{Vorgehen mit dem NanoVNA:}
Die Messung erfolgt wie bei der Gleichtaktmessung der Mantelwellensperre: Nach der Kalibrierung wird
eine serielle Transmissionsmessung durchgeführt.

\newpage % FIXME
\section{Transformatoren zur Impedanzwandlung}\label{sec:impedanztrafo}
Transformatoren zur Impedanzwandlung sind beliebt, z.B. um Fusspunktimpedanzen in den Bereich
des Wellenwiderstandes einer Speiseleitung zu transformieren. Darüber hinaus
können sie grundsätzlich zur Impedanztransformation verwendet werden. Sie sind im Gegensatz zu
anderen Anpassmethoden (wie z.B. der L-Match) breitbanding, wobei gleichzeitig gesagt
werden muss, dass es nicht einfach ist, einen breitbandingen Impedanztransformator zu bauen:
parasitäre Komponenten machen eine gute Anpassung schwierig. Was bei tiefen Frequenzen gut
funktioniert, führt bei höheren Frequenzen z.B. zu Verlusten im verwendeten Ringkern oder
zu massgeblichen Kapazitäten zwischen den einzelnen Windungen.

Eine einfache Überprüfung des Impedanzwandlers erfolgt durch Reflexionsmessung: Die eine Seite
des Transformators wird mit dem VNA verbunden, der für eine Reflexionsmessung konfiguriert ist.
Die andere Seite wird mit dem richtigen Widerstand abgeschlossen. Beispiel: Ein Transformator
mit 10 Windungen auf der Primärseite und 20 Windungen auf der Sekundärseite
wird mit der Primärseite mit dem VNA verbunden. Dieser Transformator hat das Windungsverhältnis
1:2 und somit ein Impedanzverhältnis von 1:4. Die Sekundärseite wird entsprechend mit 200~\Ohm
($4\cdot 50$~\Ohm) abgeschlossen. Unter perfekten Bedingungen müsste dieser Aufbau keine
Leistung zurückführen. In \cite{ferreira2019evaluating} wird ausserdem die Alternative diskutiert,
auch die Sekundärseite mit 50~\Ohm abzuschliessen und das Messresultat mit der theoretische
Fehlanpassung zu vergleichen. Die Reflexionsmessung ist in Abbildung \ref{fig:impedancetransformermeasurement}
auf der linken Seite dargestellt.

% FIXME: Nur die bessere Methode beschreiben, dafür ausführlicher
Wie in Abschnitt \ref{sec:antennen} bereits erläutert, ist es möglich, dass der Stimulus zwar
nicht reflektiert wird, aber auch nicht bis zum Abschlusswiderstand gelangt. Insbesondere
Verluste im Kern können hierfür verantwortlich sein. Die Prüfung dieses Sachverhaltes ist
weniger einfach. Ein gängiger Ansatz ist, die theoretische Einfügedämpfung eines perfekten
Transformators in einem 50~\Ohm System (also mit Fehlanpassung) zu berechnen und diesen
Wert mit dem tatsächlich gemessenen zu vergleichen. Ein anderer Ansatz ist es,
zwei baugleiche Impedanztransformatoren mit der Sekundärseite
zusammenzuschalten und mit einer Transmissionsmessung zu prüfen, welcher Anteil
des Stimulus in den anderen Port gelangt \cite{ferreira2019evaluating}.
Idealerweise sollte die Einfügedämpfung dieses Netzwerkes 0~dB sein. Die Transmissionsmessung
ist in Abbildung \ref{fig:impedancetransformermeasurement} auf der rechten Seite dargestellt.

\begin{figure}[H]
    \begin{center}\scalebox{0.8}{%
        \includegraphics{figures/transformer/transformer.pdf}%
    }\end{center}
     \caption{Links: Reflexionsmessung eines Impedanztransformators. Rechts: Transmissionsmessung
     mit zwei baugleichen Impedanztransformatoren.}
     \label{fig:impedancetransformermeasurement}
\end{figure}

\minisec{Vorgehen mit dem NanoVNA:}
Die Messung erfolgt gemäss Beschreibung in diesem Abschnitt.

\section{Fernbedienung mit NanoVNA Saver}\label{sec:nanovnasaver}
Der NanoVNA kann auch vom PC aus fernbedient werden. Hierfür ist die Software
``NanoVNA Saver'' geeignet; sie hat einige Vorteile gegenüber der direkten
Bedienung am Gerät.  Vorteile. Erstens ist der Computer-Bildschirm wesentlich
grösser als derjenige des NanoVNA und entsprechend ist die Bedienung und das
Ablesen der Resultate deutlich einfacher. Zweitens kann eine Messung in eine
beliebige Anzahl Teilmessungen unterteilt werden. Weil der NanoVNA stets nur
101 Messpunkte erfasst, kann mit dieser Methode die Frequenzauflösung der
Messung auf Kosten der Messgeschwindigkeit erhöht werden. Drittens kann die
Software verschiedene Untersuchungen durchführen, die mit dem NanoVNA alleine
nicht gemacht werden können. Von besonderem Interesse dürften hier die
``Distance To Fault''-Funktionalität (DTF, Untersuchung von Brüchen und
Stossstellen entlang einer Leitung) sowie die verschiedenen
Impedanz-Umrechnungen sein. Schliesslich erlaubt das Programm auch den Export
der Messresultate zur weiteren Verwendung in Microsoft Excel, SimSmith usw.
NanoVNA Saver kann auf der folgenden Projektseite kostenlos bezogen werden --
es handelt sich um freie Software:

\begin{center}
    \url{https://github.com/NanoVNA-Saver/nanovna-saver/releases/}
\end{center}

Abbildung \ref{fig:nanovnasaver} zeigt einen Screenshot der Anwendung, welche unter
Windows, Mac OS X und Linux läuft. Die Bedienung ist im wesentlichen
selbsterklärend.

\begin{figure}[H]
    \includegraphics[width=\textwidth]{figures/nanovnasaver.png}
    \caption{Screenshot von NanoVNA Saver. Quelle: Projektwebseite.}
    \label{fig:nanovnasaver}
\end{figure}


\newpage
\section*{Lizenz}
Dieses Dokument wurde 2020 von Mitgliedern der UHF-Gruppe der USKA (HB9UF) als Beilage zu
einem NanoVNA Workshop erstellt und daraufhin gepflegt und weiterentwickelt.
Weitergabe, Vervielfältigung und Änderungen sind im Rahmen der Lizenz CC BY-SA
4.0 gestattet. In diesem Fall ist der \LaTeX Quelltext zu Verfügung zu stellen.

% FIXME: Danksagung: Georg OE5AEW, Tobi DJ5TD, Andreas HB9TQR, Hansjörg HB9DWS, Mathias HB9FRV

\bibliographystyle{babunsrt}
\bibliography{nanovna_workshop_skript}

% A number of empty pages for proper bootklet printing
\newpage
\section*{Eigene Notizen}
\pagestyle{empty}
~\newpage

\section*{Menü-Übersicht (Firmware DiSlord/NanoVNA-D 1.2.20)}\label{sec:menu}

%FIXME: Check if this fits on page
\scalebox{0.8}{\rotatebox{90}{\begin{tikzpicture}[font=\sffamily]
    \tikzstyle{menu}=[draw, text width=5em, text centered, minimum height=2em, node distance=2em,on grid]
    \tikzstyle{marker}=[fill=marker]
    \tikzstyle{stimulus}=[fill=stimulus]
    \tikzstyle{cal}=[fill=cal]
    \tikzstyle{recall}=[fill=recall]
    \tikzstyle{config}=[fill=config]
    \tikzstyle{menublack}=[fill=black,text=white]
    % Main
    \node[menu] (display) {Display};
    \node[menu,marker,below of=display] (marker) {Marker};
    \node[menu,stimulus,below of=marker] (stimulus) {Stimulus};
    \node[menu,cal,below of=stimulus] (cal) {Calibrate};
    \node[menu,recall,below of=cal] (recall) {Recall};
    \node[menu,menublack,below of=recall] (measure) {Measure}; % FIXME
    \node[menu,menublack,below of=measure] (sdcard) {SD Card};
    \node[menu,config,below of=sdcard] (config) {Config};

    % Display
    \node[menu,right=30em of display] (trace) {Trace};
    \node[menu,below of=trace] (formats11) {Format S11};
    \node[menu,below of=formats11] (formats21) {Format S21};
    \node[menu,below of=formats21] (channel) {Channel};
    \node[menu,below of=channel] (scale) {Scale};
    \node[menu,below of=scale] (transform) {Transform};
    \node[menu,below of=transform] (ifbandwidth) {IF Bandw.};
    \node[menu,below of=ifbandwidth] (datasmooth) {D. Smooth};
    \node[menu,below of=datasmooth] (portz) {Port Z};

    \node[menu,right=40em of trace] (trace0) {\colorbox{trace0}{Trace 0}};
    \node[menu,below of=trace0] (trace1) {\colorbox{trace1}{Trace 1}};
    \node[menu,below of=trace1] (trace2) {\colorbox{trace2}{Trace 2}};
    \node[menu,below of=trace2] (trace3) {\colorbox{trace3}{Trace 3}};
    \node[menu,below of=trace3] (trace_store) {Store Trace};

    \node[menu,right=30em of formats11]  (logmag) {LogMag};
    \node[menu,below of=logmag]  (phase) {Phase};
    \node[menu,below of=phase]  (delay) {Delay};
    \node[menu,below of=delay]  (smith) {Smith};
    \node[menu,below of=smith]  (swr) {SWR};
    \node[menu,below of=swr]    (resist) {Resistance};
    \node[menu,below of=resist]  (react) {Reactance};
    \node[menu,below of=react]  (z) {$|$Z$|$};
    \node[menu,below of=z]  (more) {More...};

    \node[menu,above right=7em and 10em of more]  (polar) {Polar};
    \node[menu,below of=polar]  (linear) {Linear};
    \node[menu,below of=linear] (real) {Real};
    \node[menu,below of=real]  (imag) {Imag};
    \node[menu,below of=imag]  (q) {Q Factor};
    \node[menu,below of=q]     (cond) {Conduct.};
    \node[menu,below of=cond]  (susc) {Suscept.};
    \node[menu,below of=susc ] (y)    {$|$Y$|$};
    \node[menu,below of=y]  (more2) {More...};

    \node[menu,below=3em of more2] (zphase)    {Z Phase};
    \node[menu,below of=zphase] (seriesc)    {Series C};
    \node[menu,below of=seriesc] (seriesl)    {Series L};
    \node[menu,below of=seriesl] (parallelr)    {Paralell R};
    \node[menu,below of=parallelr] (parallelc)    {Paralell C};
    \node[menu,below of=parallelc] (parallell)    {Paralell L};

    \node[menu,right=20em of formats21]  (logmag2) {LogMag};
    \node[menu,below of=logmag2]  (phase2) {Phase};
    \node[menu,below of=phase2]  (delay2) {Delay};
    \node[menu,below of=delay2]  (smith2) {Smith};
    \node[menu,below of=smith2]  (polar2) {Polar};
    \node[menu,below of=polar2]    (linear) {Linear};
    \node[menu,below of=linear]  (real2) {Real};
    \node[menu,below of=real2]  (imag2) {Imag};
    \node[menu,below of=imag2]  (more3) {More...};

    \node[menu,below right=1em and 10em of more3] (seriesr2) {Series R};
    \node[menu,below of=seriesr2] (seriesx2) {Series X};
    \node[menu,below of=seriesx2] (seriesz2) {Series $|$Z$|$};
    \node[menu,below of=seriesz2] (shuntr2) {Shunt R};
    \node[menu,below of=shuntr2]  (shuntx2) {Shunt X};
    \node[menu,below of=shuntx2]  (shuntz2) {Shunt $|$Z$|$};
    \node[menu,below of=shuntz2]  (q2) {Q Factor};

    \node[menu,below right=15em and 20em of scale]  (scalediv) {Scale/Div};
    \node[menu,below of=scalediv]  (referenceposition) {Ref. Pos};
    \node[menu,below of=referenceposition]  (edelay) {E-Delay};
    \node[menu,below of=edelay]  (s21offset) {S21 Offset};
    \node[menu,below of=s21offset]  (showgridval) {Grid Val.};
    \node[menu,below of=showgridval]  (dotgrid) {Dot Grid};

    \node[menu,below right=5em and 10em of transform] (transformon) {Off/On};
    \node[menu,below of=transformon] (lowpassimpulse) {LP impulse};
    \node[menu,below of=lowpassimpulse] (lowpassstep) {LP step};
    \node[menu,below of=lowpassstep] (bandpass) {Bandpass};
    \node[menu,below of=bandpass] (window) {Window};
    \node[menu,below of=window] (velocityfactor) {Vel. Factor};

    \node[menu,below right=13em and 10em of window] (normal) {Normal};
    \node[menu,below of=normal] (minimum) {Minimum};
    \node[menu,below of=minimum] (maximum) {Maximum};

    % Marker
    \node[menu,marker,below right=26em and 30em of marker] (selectmarker) {Select M.};
    \node[menu,marker,below of=selectmarker] (markersearch) {Search};
    \node[menu,marker,below of=markersearch] (markerleft) {Search $\leftarrow$};
    \node[menu,marker,below of=markerleft] (markerright) {Search $\rightarrow$};
    \node[menu,marker,below of=markerright] (markerops) {Operations};
    \node[menu,marker,below of=markerops] (markertracking) {Tracking};

    \node[menu,marker,right=10em of selectmarker] (marker1) {Marker 1};
    \node[menu,marker,below of=marker1] (markeri) {...};
    \node[menu,marker,below of=markeri] (marker4) {Marker 8};
    \node[menu,marker,below of=marker4] (alloff) {All Off};
    \node[menu,marker,below of=alloff] (delta) {Delta};

    \node[menu,marker,below right=11em and 10em of selectmarker] (markerstart) {$\rightarrow$Start};
    \node[menu,marker,below of=markerstart] (markerstop) {$\rightarrow$Stop};
    \node[menu,marker,below of=markerstop] (markercenter) {$\rightarrow$Center};
    \node[menu,marker,below of=markercenter] (markerspan) {$\rightarrow$Span};
    \node[menu,marker,below of=markerspan] (markerdelay) {$\rightarrow$E-Delay};

    % Stimulus
    \node[menu,stimulus,right=20em of stimulus] (start) {Start};
    \node[menu,stimulus,below of=start] (stop) {Stop};
    \node[menu,stimulus,below of=stop] (center) {Center};
    \node[menu,stimulus,below of=center] (span) {Span};
    \node[menu,stimulus,below of=span] (cwfreq) {CW Freq};
    \node[menu,stimulus,below of=cwfreq] (jogstep) {Jog Step};
    \node[menu,stimulus,below of=jogstep] (sweeppts) {Sweep Pts.};

    % Cal
    \node[menu,cal,right=10em of cal] (calibrate) {Calibrate};
    \node[menu,cal,below of=calibrate] (power) {Power};
    \node[menu,cal,below of=power] (calsave) {Save};
    \node[menu,cal,below of=calsave] (resetrange) {Rst. Range};
    \node[menu,cal,below of=resetrange] (reset) {Reset};
    \node[menu,cal,below of=reset] (apply) {Apply};

    \node[menu,cal,below right=15em and 10em of calibrate] (open) {Open};
    \node[menu,cal,below of=open] (short) {Short};
    \node[menu,cal,below of=short] (load) {Load};
    \node[menu,cal,below of=load] (isoln) {Isoln};
    \node[menu,cal,below of=isoln] (thru) {Thru};
    \node[menu,cal,below of=thru] (edelay) {E-Delay};
    \node[menu,cal,below of=edelay] (done) {Done};
    \node[menu,cal,below of=done] (doneram) {Done RAM};

    \node[menu,cal,below right=28em and 10em of calsave] (save0) {Save 0};
    \node[menu,cal,below of=save0] (savei) {...};
    \node[menu,cal,below of=savei] (save4) {Save 4};

    % Recall
    \node[menu,recall,below right=14 em and 10em of recall] (recall0){Recall 0};
    \node[menu,recall,below of=recall0] (recalli){...};
    \node[menu,recall,below of=recalli] (recall4){Recall 4};

    % Config
    \node[menu,config,below right=22em and 10em of config] (touchcal) {Touch Cal};
    \node[menu,config,below of=touchcal] (touchtest) {Touch Test};
    \node[menu,config,below of=touchtest] (expert) {Expert};
    \node[menu,config,below of=expert] (configsave) {Save};
    \node[menu,config,below of=configsave] (connection) {Connection};
    \node[menu,config,below of=connection] (version) {Version};
    \node[menu,config,below of=version] (dfu) {DFU};

    \draw[thick,-stealth'] (display) -- (trace);
    \draw[thick,-stealth'] (marker) -- +(25em,0em) |- (selectmarker);
    \draw[thick,-stealth'] (stimulus) -- (start);
    \draw[thick,-stealth'] (cal) -- (calibrate);
    \draw[thick,-stealth'] (recall) -- +(5.5em,0em) |- (recall0);
    \draw[thick,-stealth'] (config) -- +(4.5em,0em) |- (touchcal);

    \draw[thick,-stealth'] (trace) -- (trace0);
    \draw[thick,-stealth'] (formats11) -- (logmag);
    \draw[thick,-stealth'] (formats21) -- (logmag2);
    \draw[thick,-stealth'] (scale) -- +(15em,0em) |- (scalediv);
    \draw[thick,-stealth'] (transform) -- +(5em,0em) |- (transformon);
    \draw[thick,-stealth'] (window) -- +(4.5em,0em) |- (normal);

    \draw[thick,-stealth'] (more) -- +(4.5em,0em) |- (polar);
    \draw[thick,-stealth'] (more2) -- (zphase);

    \draw[thick,-stealth'] (more3) -- +(4.5em,0em) |- (seriesr2);

    \draw[thick,-stealth'] (selectmarker) -- (marker1);
    \draw[thick,-stealth'] (markerops) -- +(5em,0em) |- (markerstart);

    \draw[thick,-stealth'] (calibrate) -- +(5.5em,0em) |- (open);
    \draw[thick,-stealth'] (calsave) -- +(4.5em,0em) |-(save0);
\end{tikzpicture}}}


% FIXME: Sammmel-Ecke für Ideen:
% Vergleich mit Bauteiltester
% Parasitäre Kapazität in Spulen
% Koaxialkabel (insb. 75 Ohm)?
% Langes, schleches Koax?
% Dummy Load?
% RLC Schwingkreis (auch als Simulation für Antenne, Einfluss Tuner etc.)
% Tiefpass und Hochpass aus diskreten Bauteilen mit Klemmen
% Kavitäten
% Lambda/4 Leitung mit Verkürzungsfaktor
% Koax im Smith Diagramm, mit Verküruzungsfaktor und Verlängerung (adapter)
% Attenuators of various quality 
% directional couplers
% Hybrid coupler
% Antenna switch
% Wilkinson splitter
% Bias T
% Bestimmung A_L Wert.
% Mantelwellensperren vergleichen, Perle um Perle aufziehen.
% Resonanzfrequenz, Nebenresonanzen, Obertöne etc. eines Schwingquarzes
% Messung Impedanzwandler
% Antennengewinn
% TDR
% Firmware Upgrade
% Funktionsprinzip
% Grid dip meter
% Zubehör:


%   Zubehör:
%   - USB C Kabel (gute Qualität)
%   - USB C Adapter
%   - Anderes Calkit
%   - Stift
%   - Schutzfolie
%   - Case
%   - Testprint
%   - Ladestrom
%   - Firmware mods

% https://www.rtl-sdr.com/nanovna-version-2-0-first-pcb-pictures-released-nanovna-naming-credit-clarifications/
% http://ormpoa.altervista.org/firmware.htm
% https://www.nonstopsystems.com/radio/frank_radio_coax-sw.htm

% FIXME:
%- Make smith gray and pgfplot line gray the same

\end{document}
